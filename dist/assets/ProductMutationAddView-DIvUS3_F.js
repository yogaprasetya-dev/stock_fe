import{u as ee,O as ae,v as i,a6 as te,G as oe,N as k,p as le,w as se,o as x,y as a,c as W,t as G,b as v,x as N,Q as re,A as ie,z as ne,F as ue,P as de,E as ve}from"./index-DCDvUKXo.js";import{_ as ce}from"./Card.vue_vue_type_script_setup_true_lang-DrCnTswZ.js";import{_ as me}from"./Checkbox.vue_vue_type_script_setup_true_lang-B9YpqYCd.js";import{_ as pe}from"./DatePicker.vue_vue_type_script_setup_true_lang-DALjuQLu.js";import{_ as C}from"./Dropdown.vue_vue_type_script_setup_true_lang-CVwp3vwr.js";import{_ as Q}from"./Icon.vue_vue_type_script_setup_true_lang-Bj9qPpRn.js";import{_ as fe}from"./InputNumber.vue_vue_type_script_setup_true_lang-BxeE40fF.js";import{_ as ge}from"./InputText.vue_vue_type_script_setup_true_lang-BJxyKWA0.js";import{S as _}from"./stock.service-BJq6lT8Q.js";import{S as he}from"./store.service-BvlUCZ66.js";import{d as be}from"./data.utils-eGwCzW_2.js";import{s as j}from"./index-COYv8ewU.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-W1x2WogQ.js";import"./index-DrEEKm_D.js";import"./index-ddyPgsAF.js";import"./index-CAfW60JH.js";import"./index-Cb8PJ9gJ.js";import"./index-DEeMGGCH.js";import"./index-Bf2Yba-6.js";import"./api.service-DQTyQFCJ.js";import"./index-D3QVXGA5.js";const ye={class:"flex items-center gap-10"},we={class:"w-full"},ke={class:"w-full"},xe={class:"flex items-center gap-10 w-full"},_e={class:"w-full"},Se={class:"flex gap-4 py-1 !text-xs"},Ve={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},Te={key:0,class:"grid grid-cols-2 w-full pr-10"},We={class:"grid grid-cols-2 pr-10 w-full"},Ce={class:"flex items-center gap-10 pt-2"},Me={class:"w-[460px]"},Ue={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},$e={class:"w-full"},Ie={class:"w-[30%] flex flex-col gap-2"},Be={class:"text-xs text-center"},De={class:"w-full"},Oe={class:"h-full flex items-end"},Ee={class:"w-[30px]"},qe=["onClick"],Fe={class:"flex justify-end pt-8"},Ge={class:"flex flex-col gap-4 items-end"},da=ee({__name:"ProductMutationAddView",setup(Ne){const z=ve(),n=ae(),g=i(),m=i(),u=i(),h=i(),r=i([]),S=i([]),V=i(),c=i([]),b=i(!1),d=te(0),M=i(0),U=i([]),$=i([]),p=i([]),l=i();oe(()=>{m.value=new Date,w()});const H=()=>{d.value+=1,y()},J=t=>{d.value>0&&(d.value-=1,r.value.splice(t,1),c.value.splice(t,1),y())},I=()=>{g.value=void 0,m.value=void 0,u.value=void 0,h.value=void 0,r.value=[],c.value=[],b.value=!1,d.value=0,m.value=void 0,y()},B=()=>{z.back()},D=async()=>{try{const{data:t}=await he.getStoreDropdown();V.value=t.data}catch(t){console.error("Error fetching store options:",t)}},y=()=>{g.value=be(M.value)},K=t=>{if(r.value[t]){if(l.value==="warehouse"){const e=$.value.find(o=>o.id===r.value[t].id);p.value[t]=(e==null?void 0:e.quantity)??0}else if(l.value==="store"){const e=U.value.find(o=>o.product.id===r.value[t].id);p.value[t]=(e==null?void 0:e.quantity)??0}}else p.value[t]=0},w=async()=>{try{const{data:t}=await _.getStockMutationIndex();M.value=t.data.nextCode,y()}catch(t){console.error("Error fetching stock in index:",t)}},R=async()=>{l.value=="store"?await L():l.value=="warehouse"&&await A()},A=async()=>{try{const{data:t}=await _.getWarehouseStockDropdown();$.value=t.data,S.value=t.data.map(e=>({id:e.id,name:e.name}))}catch(t){console.error("Error fetching warehouse stock:",t)}},L=async()=>{try{if(!u.value)return;const{data:t}=await _.getStoreStockById(u.value.id);U.value=t.data,S.value=t.data.map(e=>({id:e.product.id,name:e.product.name}))}catch(t){console.error("Error fetching store stock:",t)}},X=async()=>{var t,e,o,f,O,E,q;try{if(!g.value||!m.value){n.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!l.value){n.add({severity:"warn",summary:"Warning",detail:"Pilih sumber barang (Gudang/Toko)",life:3e3});return}if(l.value==="store"&&!u.value){n.add({severity:"warn",summary:"Warning",detail:"Pilih gudang sumber barang",life:3e3});return}if(!h.value){n.add({severity:"warn",summary:"Warning",detail:"Pilih toko tujuan barang",life:3e3});return}if(d.value===0){n.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(r.value.filter(s=>s!==void 0&&s.id!==void 0).length!==d.value){n.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(c.value.filter(s=>s!==void 0&&s>0).length!==d.value){n.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}for(let s=0;s<r.value.length;s++){const T=r.value[s],Z=c.value[s],F=p.value[s];if(Z>F){n.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${T.name} tidak boleh lebih dari stok yang tersedia (${F})`,life:3e3});return}}if(l.value==="store"&&((t=u.value)==null?void 0:t.id)===((e=h.value)==null?void 0:e.id)){n.add({severity:"warn",summary:"Warning",detail:"Sumber barang dan tujuan barang tidak boleh sama",life:3e3});return}const Y={transactionCode:g.value,date:(o=m.value)==null?void 0:o.toISOString(),fromWarehouse:l.value==="warehouse",fromStoreId:l.value==="store"?(f=u.value)==null?void 0:f.id:null,toStoreId:(O=h.value)==null?void 0:O.id,products:r.value.map((s,T)=>({productId:s==null?void 0:s.id,quantity:c.value[T]}))};await _.postStockMutation(Y),n.add({severity:"success",summary:"Success",detail:"Barang mutasi berhasil dibuat",life:3e3}),b.value?I():(B(),w())}catch(P){n.add({severity:"error",summary:"Error",detail:P?(q=(E=P.response)==null?void 0:E.data)==null?void 0:q.message:"Gagal membuat barang mutasi",life:3e3})}};return k(()=>r.value,()=>{w()},{immediate:!0}),k(()=>m.value,()=>{w()},{immediate:!0}),k(()=>l.value,()=>{(l.value==="store"||l.value==="warehouse")&&(r.value=[],c.value=[],p.value=[],d.value=0,u.value=void 0)},{immediate:!0}),k(()=>u.value,()=>{u.value&&(r.value=[],c.value=[],p.value=[],d.value=0)},{immediate:!0}),(t,e)=>(x(),le(ce,null,{default:se(()=>[a("form",{class:"flex flex-col p-4 gap-3",onSubmit:de(X,["prevent"])},[a("div",ye,[a("div",we,[v(ge,{"model-value":g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),a("div",ke,[v(pe,{"model-value":m.value,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),a("div",xe,[a("div",_e,[e[9]||(e[9]=a("span",{class:"text-xs"},"Dari Gudang/Toko",-1)),a("div",Se,[a("div",Ve,[v(N(j),{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value=o),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small"},null,8,["modelValue"]),e[7]||(e[7]=a("label",{for:"warehouse"},"Gudang",-1))]),a("div",Pe,[v(N(j),{modelValue:l.value,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value=o),inputId:"store",name:"toWarehouse",value:"store",size:"small"},null,8,["modelValue"]),e[8]||(e[8]=a("label",{for:"store"},"Toko",-1))])])])]),l.value==="store"?(x(),W("div",Te,[v(C,{"model-value":u.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value=o),placeholder:"Pilih Toko",label:"Sumber Barang",options:V.value,onOpen:D},null,8,["model-value","options"])])):G("",!0),a("div",We,[v(C,{"model-value":h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),placeholder:"Pilih Toko",label:"Tujuan Barang",options:V.value,onOpen:D},null,8,["model-value","options"])]),a("div",Ce,[a("div",Me,[a("button",{type:"button",onClick:H,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[e[10]||(e[10]=re(" Tambah Produk ")),v(Q,{icon:"add"})])])]),d.value>0?(x(!0),W(ue,{key:1},ie(d.value,o=>(x(),W("div",{key:o,class:"flex items-center gap-4 pt-2 w-full"},[a("div",Ue,[a("div",$e,[v(C,{"model-value":r.value[o-1],"onUpdate:modelValue":f=>r.value[o-1]=f,placeholder:"Pilih Produk",label:"Produk",options:S.value,onHide:f=>K(o-1),onOpen:R},null,8,["model-value","onUpdate:modelValue","options","onHide"])]),a("div",Ie,[e[11]||(e[11]=a("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),a("span",Be,ne(p.value[o-1]?p.value[o-1]:"-"),1)]),a("div",De,[v(fe,{"model-value":c.value[o-1],"onUpdate:modelValue":f=>c.value[o-1]=f,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),a("div",Oe,[a("div",Ee,[a("button",{type:"button",onClick:f=>J(o-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[v(Q,{icon:"delete-bin"})],8,qe)])])])]))),128)):G("",!0),e[13]||(e[13]=a("div",null,null,-1)),a("div",Fe,[a("div",Ge,[v(me,{"model-value":b.value,"onUpdate:modelValue":e[6]||(e[6]=o=>b.value=o),label:"Tetap di sini?"},null,8,["model-value"]),a("div",{class:"flex gap-2"},[a("button",{type:"button",onClick:B,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),a("button",{type:"button",onClick:I,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[12]||(e[12]=a("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{da as default};
