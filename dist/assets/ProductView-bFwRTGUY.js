import{_ as I}from"./DataTable.vue_vue_type_script_setup_true_lang-CbMYRQ15.js";import{P as T}from"./product.service-BVJZTujx.js";import{_ as j}from"./Card.vue_vue_type_script_setup_true_lang-Cuer2ZPA.js";import{_ as J}from"./Button.vue_vue_type_script_setup_true_lang-Dbzamzgb.js";import{_ as W}from"./ButtonMultiAction.vue_vue_type_script_setup_true_lang-CjWboVzZ.js";import{u as H,v as r,a6 as q,G as K,M as z,q as Q,a7 as X,o as A,c as L,a8 as Y,y as b,b as i,O as Z,J as D,L as $,E as ee,K as ae,N as te,p as U,w as E,F as le,r as oe,t as se,x as re}from"./index-BjTs3afa.js";import{_ as ie}from"./DialogConfirm.vue_vue_type_style_index_0_lang-CO3iVBVd.js";import{e as w}from"./index-CFjhT2rJ.js";import{f as R}from"./data.utils-eGwCzW_2.js";import{_ as ne}from"./InputNumber.vue_vue_type_script_setup_true_lang-BWSF95r2.js";import{_ as ue}from"./Dialog.vue_vue_type_script_setup_true_lang-D0uEwV9v.js";import{_ as de,a as ce}from"./ButtonSearch.vue_vue_type_script_setup_true_lang-BhWZgCFr.js";import{_ as G}from"./DatePicker.vue_vue_type_script_setup_true_lang-DiSafQeX.js";import{_ as F}from"./MultiSelect.vue_vue_type_script_setup_true_lang-D8ZDj66X.js";import"./Icon.vue_vue_type_script_setup_true_lang-PK0I0i2N.js";import"./Animation-E763Zqzq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BETDS0_O.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-CO-5GhtW.js";import"./index-PZ4nG-UA.js";import"./index-CTr9FoHh.js";import"./index-u6-QjOpb.js";import"./api.service-D-uoeG8j.js";import"./index-MGwmnnen.js";import"./index-hQcaioZr.js";import"./index-CJe_Z7Wk.js";import"./index-gbCzRzNO.js";import"./InputText.vue_vue_type_script_setup_true_lang-BraHHpVR.js";import"./index-38uiiw7a.js";const me={class:"!overflow-hidden"},ve={class:"!overflow-hidden"},pe={class:"!overflow-hidden"},be={class:"!overflow-hidden"},fe={class:"!overflow-hidden"},ye={class:"flex items-end justify-end gap-2","data-wv-section":"filteractionbuttons",style:{"grid-area":"2/4"}},he=H({inheritAttrs:!1,__name:"ProductFilterFields",props:{tableName:{default:"product-table"}},emits:["apply"],setup(M,{emit:y}){const k=r(4),h=r(),n=r(),u=r(),d=r([]),m=r([]),g=r([]),c=r([]),o=r([]),B=q(!1),S=r(null),f=M,_=y;K(()=>{C(),w.on("show-filter",N)}),z(()=>{w.off("show-filter",N)});const O=()=>{const l={};if(w.emit("multi-select:hide-overlay"),h.value&&h.value.length>0&&(l.brand=JSON.stringify(h.value)),n.value&&n.value.length>0&&(l.category=JSON.stringify(n.value)),u.value&&u.value.length>0&&(l.unit=JSON.stringify(u.value)),c.value&&c.value.length>0){const t=c.value[0]?new Date(c.value[0]):null,e=c.value[1]?new Date(c.value[1]):new Date(c.value[0]),a=[t];e&&a.push(e),l.updatedAt=JSON.stringify(a)}if(o.value&&o.value.length>0){const t=o.value[0]?new Date(o.value[0]):null,e=o.value[1]?new Date(o.value[1]):new Date(o.value[0]),a=[t];e&&a.push(e),l.createdAt=JSON.stringify(a)}w.emit("data-table:apply-filter",{tableName:f==null?void 0:f.tableName,filter:l}),w.emit("data-table:clear-selected-data",{tableName:f==null?void 0:f.tableName}),_==null||_("apply",l)},V=()=>{h.value=[],n.value=[],u.value=[],c.value=[],o.value=[]},N=l=>{l.tableName===f.tableName&&(B.value=l.show)},C=()=>{if(S.value){const{children:l}=S.value,t=S.value.childElementCount,e=t%k.value;let[a,v]=[1,1];for(const s in Array.from({length:t})){const P=Number(s)===t-1;l[s].setAttribute("style",`grid-area: ${a}/${P&&e?k.value:v}`),++v>k.value&&(v=1,a++)}}},x=async l=>{try{let t={};l==="brand"&&(t.brand=JSON.stringify(!0)),l==="category"&&(t.category=JSON.stringify(!0)),l==="unit"&&(t.unit=JSON.stringify(!0));const{data:e}=await T.getProductOption(t);l==="brand"&&(d.value=e.data.brand),l==="category"&&(m.value=e.data.category),l==="unit"&&(g.value=e.data.unit)}catch(t){console.error("Error fetching filter options:",t)}};return(l,t)=>Q((A(),L("div",{ref_key:"container",ref:S,class:"grid gap-4 py-2 bg-[#5080e1]/10 rounded-md px-3",style:Y(`grid-template-columns: repeat(${k.value}, 1fr)`)},[b("div",me,[i(F,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),options:d.value,onShow:t[1]||(t[1]=e=>x("brand")),controls:"",label:"Brand",placeholder:"Pilih Brand","option-label":"label","option-value":"value"},null,8,["modelValue","options"])]),b("div",ve,[i(F,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value=e),options:m.value,onShow:t[3]||(t[3]=e=>x("category")),controls:"",label:"Kategori",placeholder:"Pilih Kategori","option-label":"label","option-value":"value"},null,8,["modelValue","options"])]),b("div",pe,[i(F,{modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=e=>u.value=e),options:g.value,onShow:t[5]||(t[5]=e=>x("unit")),controls:"",label:"Satuan",placeholder:"Pilih Satuan","option-label":"label","option-value":"value"},null,8,["modelValue","options"])]),b("div",be,[i(G,{"model-value":c.value,"onUpdate:modelValue":t[6]||(t[6]=e=>c.value=e),label:"Terakhir Diubah",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),b("div",fe,[i(G,{"model-value":o.value,"onUpdate:modelValue":t[7]||(t[7]=e=>o.value=e),label:"Dibuat Pada",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),b("div",ye,[i(J,{onClick:V,label:"Bersihkan Fields","data-wv-section":"clearbutton",severity:"secondary",class:"text-xs"}),i(J,{onClick:O,label:"Terapkan Filter","data-wv-section":"applybutton",severity:"success",class:"text-xs"})])],4)),[[X,B.value]])}}),ge={class:"flex flex-col gap-2 text-black overflow-x-auto w-full"},ke={class:"flex flex-col gap-2"},_e={class:"flex flex-row justify-start gap-2"},we={class:"w-full flex justify-end gap-2"},Se={class:"w-full"},Ze=H({__name:"ProductView",setup(M){const y=Z(),k=ee(),h=ae();K(()=>{var a;const e=JSON.parse(localStorage.getItem("user"));c.value=(a=e==null?void 0:e.role)==null?void 0:a.name});const n=r({visible:!1,type:"add",header:"Tambah Kategori",useStay:!1}),u=r(),d=r(),m=r([]),g=r([]),c=r(),o=r({visible:!1,header:"",severity:"success",confirmButtonSeverity:"success"}),B=D(()=>{var e;return[{label:"Edit Produk",icon:"edit",visible:$("product").update,command:()=>{var a;m.value=[],sessionStorage.setItem("product",JSON.stringify((a=d.value)==null?void 0:a.id)),k.push("/product/data/edit")}},{label:"Edit Batas Stok",icon:"edit",visible:((e=c.value)==null?void 0:e.toLowerCase())==="owner",command:()=>{var a;u.value=(a=d.value)==null?void 0:a.threshold,n.value={visible:!0,type:"edit",header:"Edit Batas Stok",useStay:!1}}},{label:"Hapus",icon:"delete-bin",danger:!0,visible:$("product").delete,command:()=>{g.value=[d.value],o.value={visible:!0,header:"Hapus Barang",severity:"error",confirmButtonSeverity:"danger",message:"Apakah kamu yakin ingin menghapus Barang ini?",list:g.value.map(a=>a.name),confirmLabel:"Hapus",actionable:!0}}}]}),S=D(()=>[{label:"Hapus",icon:"delete-bin",visible:$("product").delete,danger:!0,command:()=>{g.value=m.value,o.value={visible:!0,header:"Hapus Barang",severity:"error",confirmButtonSeverity:"danger",message:"Apakah kamu yakin ingin menghapus barang ini?",list:g.value.map(e=>e.name),confirmLabel:"Hapus",actionable:!0}}}]),f=[{header:"Kode Produk",field:"code",sortable:!0,bodyTemplate:e=>e.code?e.code:"-"},{header:"Nama Produk",field:"name",sortable:!0,bodyTemplate:e=>e.name?e.name:"-"},{header:"Deskripsi",field:"description",sortable:!0,bodyTemplate:e=>e.description?e.description:"-"},{header:"Merek",field:"brand.name",sortable:!0,bodyTemplate:e=>e.brand?e.brand.name:"-"},{header:"Kategori",field:"category.name",sortable:!0,bodyTemplate:e=>e.category?e.category.name:"-"},{header:"Batas Stok",field:"threshold",sortable:!0,bodyTemplate:e=>e.threshold!==void 0?e.threshold.toString():"-"},{header:"Satuan",field:"unit.name",sortable:!0,bodyTemplate:e=>e.unit?e.unit.name:"-"},{header:"Terakhir Diubah",field:"updatedAt",sortable:!0,bodyTemplate:e=>e.updatedAt?R(new Date(e.updatedAt)):"-"},{header:"Dibuat Pada",field:"createdAt",sortable:!0,bodyTemplate:e=>e.createdAt?R(new Date(e.createdAt)):"-"}],_=D(()=>h.path.split("/").pop()),O=()=>{d.value=void 0,m.value=[],k.push("/product/data/add")},V=()=>{u.value=void 0},N=e=>{l()},C=async()=>{await t(g.value.map(e=>e.id))},x=async e=>{try{const{data:a}=await T.getProduct(e);return a}catch(a){console.error("Error fetching data:",a)}},l=async()=>{var e,a,v;try{if(u.value===void 0||u.value===null||u.value<0){y.add({severity:"warn",summary:"Warning",detail:"Batas stok tidak boleh kosong",life:3e3});return}const s={threshold:u.value};await T.updateThreshold((e=d==null?void 0:d.value)==null?void 0:e.id,s),y.add({severity:"success",summary:"Berhasil",detail:"Batas stok berhasil diperbarui",life:3e3}),n.value.visible=!1,m.value=[],d.value=void 0,w.emit("data-table:update",{tableName:"table-product"})}catch(s){console.error("Error updating threshold:",s),y.add({severity:"error",summary:"Gagal",detail:s?(v=(a=s.response)==null?void 0:a.data)==null?void 0:v.message:"Gagal memperbarui batas stok",life:3e3})}},t=async e=>{var a,v;try{if(e.length===0){y.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih untuk dihapus",life:3e3});return}const s={id:e};await T.deleteProduct(s),o.value.visible=!1,y.add({severity:"success",summary:"Berhasil",detail:"Produk berhasil dihapus",life:3e3}),m.value=[],d.value=void 0,w.emit("data-table:update",{tableName:"table-product"})}catch(s){console.error("Error deleting product:",s),y.add({severity:"error",summary:"Gagal",detail:s?(v=(a=s.response)==null?void 0:a.data)==null?void 0:v.message:"Gagal menghapus produk",life:3e3})}};return te(()=>n.value.visible,()=>{n.value.visible||V()},{immediate:!0}),(e,a)=>{var s,P;const v=oe("router-view");return _.value==="add"||_.value==="edit"||_.value==="detail"?(A(),U(v,{key:0})):(A(),L(le,{key:1},[i(j,null,{default:E(()=>[b("div",ge,[b("div",ke,[b("div",_e,[i(W,{"selected-data":m.value,"onUpdate:selectedData":a[0]||(a[0]=p=>m.value=p),options:S.value,"table-name":"table-product"},null,8,["selected-data","options"]),b("div",we,[i(de,{"table-name":"table-product"}),i(ce,{"table-name":"table-product"}),re($)("product").create?(A(),U(J,{key:0,onClick:O,label:"Tambah Barang",severity:"primary",class:"text-xs"})):se("",!0)])]),i(he,{"table-name":"table-product"}),i(I,{"data-key":"id","fetch-function":x,columns:f,options:B.value,onToggleOption:a[1]||(a[1]=p=>d.value=p),"onUpdate:selectedData":a[2]||(a[2]=p=>m.value=p),"table-name":"table-product","selection-type":"checkbox","use-paginator":""},null,8,["options"])])])]),_:1}),i(ue,{visible:n.value.visible,"onUpdate:visible":a[4]||(a[4]=p=>n.value.visible=p),header:(s=n.value)==null?void 0:s.header,class:"w-[400px] !bg-white !border-none text-black","use-stay":(P=n.value)==null?void 0:P.useStay,"use-close":!0,closable:!1,onSubmit:N},{default:E(()=>[b("div",Se,[i(ne,{modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=p=>u.value=p),label:"Batas Stok",placeholder:"Masukkan batas stok"},null,8,["modelValue"])])]),_:1},8,["visible","header","use-stay"]),i(ie,{visible:o.value.visible,"onUpdate:visible":a[5]||(a[5]=p=>o.value.visible=p),onConfirm:C,header:o.value.header,"header-icon":"check",list:o.value.list,message:o.value.message,severity:o.value.severity,"confirm-button-severity":o.value.confirmButtonSeverity},null,8,["visible","header","list","message","severity","confirm-button-severity"])],64))}}});export{Ze as default};
