import{_ as U}from"./api.service-Dgs1boU1.js";import{_ as $}from"./DatePicker.vue_vue_type_script_setup_true_lang-DWsIWa76.js";import{_ as I}from"./Dropdown.vue_vue_type_script_setup_true_lang-6IRzW13W.js";import{_ as q}from"./InputNumber.vue_vue_type_script_setup_true_lang-DaGHc2o6.js";import{_ as D}from"./InputText.vue_vue_type_script_setup_true_lang-e6c03x4O.js";import{S as b}from"./stock.service-C4NW6Gnu.js";import{u as N,M as W,v as n,a5 as F,y as J,L as M,p as K,w as Q,o as x,z as a,c as P,t as R,b as h,C as L,A as j,F as z,E as A}from"./index-DOh3iN_U.js";import"./auth.service-BxJEy6Ur.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-DO9keWeT.js";import"./index-HQkD5G-S.js";import"./index-CC8nIHWH.js";import"./index-__IG_7Gg.js";import"./index-LYmElTQ-.js";import"./index-4eifDWYF.js";import"./index-QsIXXSH_.js";const G={class:"flex flex-col p-4 gap-3"},H={class:"flex items-center gap-10"},X={class:"w-full"},Y={class:"w-full"},Z={class:"w-full"},ee={class:"grid grid-cols-2 pr-10 w-full"},te={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},ae={class:"w-full"},oe={class:"w-[30%] flex flex-col gap-2"},re={class:"text-xs text-center"},le={class:"w-full"},_e=N({__name:"ProductOutEditView",setup(se){const O=A(),d=W(),v=n(),c=n(),p=n(),s=n([]),u=n([]),m=F(0),_=n([]),g=n([]),k=n();J(()=>{C(),T()});const V=()=>{u.value=[],c.value=void 0},w=()=>{O.back()},C=async()=>{var r,e,t;try{const l=(r=JSON.parse(sessionStorage.getItem("productOut")||"{}"))==null?void 0:r.id;if(!l){console.error("Product Out ID not found in session storage");return}const{data:i}=await b.getStockOutById(Number(l));k.value=i.data,v.value=i.data.transactionCode,c.value=new Date(i.data.date),p.value={id:(e=i.data.fromStore)==null?void 0:e.id,name:(t=i.data)==null?void 0:t.fromStore.name},i.data.products.forEach(f=>{s.value.push({id:f.id,name:f.name}),u.value.push(f.quantity)}),m.value=i.data.products.length}catch(l){console.error("Error fetching product out:",l)}},T=async()=>{var r;try{const e=(r=JSON.parse(sessionStorage.getItem("productOut")||"{}"))==null?void 0:r.fromStoreId;if(!e){console.error("Store ID not found in session storage");return}const{data:t}=await b.getStoreStockById(e);_.value=t.data}catch(e){console.error("Error fetching store stock:",e)}},B=async()=>{var r,e,t;try{if(!v.value||!c.value){d.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!p.value){d.add({severity:"warn",summary:"Warning",detail:"Toko harus dipilih",life:3e3});return}if(s.value.filter(o=>o!==void 0&&o.id!==void 0).length!==m.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(m.value===0){d.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(u.value.filter(o=>o!==void 0&&o>0).length!==m.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}for(let o=0;o<s.value.length;o++){const y=s.value[o],E=u.value[o],S=g.value[o];if(E>S){d.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${y.name} tidak boleh lebih dari stok yang tersedia (${S})`,life:3e3});return}}const f={transactionCode:v.value,date:(r=c.value)==null?void 0:r.toISOString(),storeId:((e=p.value)==null?void 0:e.id)??null,products:s.value.map((o,y)=>({id:o.id,quantity:u.value[y]}))};await b.updateStockOut((t=k==null?void 0:k.value)==null?void 0:t.id,f),d.add({severity:"success",summary:"Success",detail:"Stok keluar berhasil diedit",life:3e3}),w()}catch{d.add({severity:"error",summary:"Error",detail:"Gagal mengedit stok keluar",life:3e3})}};return M(()=>s.value,()=>{g.value=s.value.map(r=>{const e=_.value.find(t=>t.product.id===r.id);return e?e.quantity:0})},{immediate:!0,deep:!0}),(r,e)=>(x(),K(U,null,{default:Q(()=>[a("div",G,[a("div",H,[a("div",X,[h(D,{"model-value":v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),a("div",Y,[h($,{"model-value":c.value,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),a("div",Z,[a("div",ee,[h(I,{"model-value":p.value,"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),placeholder:"Pilih Toko",label:"Toko","disabled-button":""},null,8,["model-value"])])]),m.value>0?(x(!0),P(z,{key:0},L(m.value,t=>(x(),P("div",{key:t,class:"flex items-center gap-4 pt-2 w-full"},[a("div",te,[a("div",ae,[h(I,{"model-value":s.value[t-1],"onUpdate:modelValue":l=>s.value[t-1]=l,placeholder:"Pilih Produk",label:"Produk","disabled-button":""},null,8,["model-value","onUpdate:modelValue"])]),a("div",oe,[e[3]||(e[3]=a("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),a("span",re,j(g.value[t-1]?g.value[t-1]:"-"),1)]),a("div",le,[h(q,{"model-value":u.value[t-1],"onUpdate:modelValue":l=>u.value[t-1]=l,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])])])]))),128)):R("",!0),e[4]||(e[4]=a("div",null,null,-1)),a("div",{class:"flex justify-end pt-8"},[a("div",{class:"flex flex-col gap-4 items-end"},[a("div",{class:"flex gap-2"},[a("button",{onClick:w,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),a("button",{onClick:V,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),a("button",{onClick:B,class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ")])])])])]),_:1}))}});export{_e as default};
