import{_ as D}from"./Card.vue_vue_type_script_setup_true_lang-Bl0DslN5.js";import{_ as M}from"./DataTable.vue_vue_type_script_setup_true_lang-BS6nFKDe.js";import{S as L}from"./stock.service-BcxG16rP.js";import{f as V}from"./data.utils-eGwCzW_2.js";import{_ as $}from"./DatePicker.vue_vue_type_script_setup_true_lang-BCQAJcoL.js";import{_ as I}from"./Icon.vue_vue_type_script_setup_true_lang-CRD0Yvi0.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-CCMaiNve.js";import{e as C}from"./index-CFjhT2rJ.js";import{E as j,a as R}from"./jspdf.plugin.autotable-BkVtuT2X.js";import{s as x}from"./index-D_g3COFb.js";import{u as U,v as m,N as S,p as A,w as J,o as P,y as l,b as i,x as _}from"./index-BGCjVxet.js";import"./Animation-tEbJ7J_3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BOijICIK.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-D-XmK6Ot.js";import"./index-BdQHsZDF.js";import"./index-Di0XHDVR.js";import"./index-c5Mf9KwK.js";import"./api.service-DGtXVYHe.js";import"./index-MGwmnnen.js";import"./index-Bs_0ViQP.js";import"./index-cMUTYv_7.js";const q={class:"flex flex-col gap-3 text-black"},z={class:"flex flex-col gap-2 pt-2"},E={class:"flex flex-row justify-start gap-2 w-full items-center"},H={class:"pr-4"},K={class:"flex gap-4 py-1 !text-xs"},O={class:"flex items-center gap-2"},Q={class:"flex items-center gap-2"},Y={class:"grid grid-cols-2 gap-2 w-full"},G={class:"w-full flex justify-end gap-2"},W={class:"flex items-center gap-1"},xe=U({__name:"ReportProductMutationView",setup(X){const n=m("date"),o=m(),g=m([]),v=m([["No","Tanggal Transaksi","Kode Barang","Barang","Jumlah Barang","Sumber Barang","Tujuan Barang"]]),p=m([]),B=[{field:"date",header:"Tanggal Transaksi",sortable:!1,bodyTemplate:t=>t.date?V(new Date(t.date)):"-"},{field:"product.code",header:"Kode Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:t=>{var e;return(e=t==null?void 0:t.products)==null?void 0:e.map(a=>({value:`${a.code}`}))}}},{field:"product.name",header:"Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:t=>{var e;return(e=t==null?void 0:t.products)==null?void 0:e.map(a=>({value:`${a.name}`}))}}},{field:"product.quantity",header:"Jumlah Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:t=>{var e;return(e=t==null?void 0:t.products)==null?void 0:e.map(a=>({value:`${a.quantity}`}))}}},{field:"fromStore",header:"Sumber Barang",sortable:!1,bodyTemplate:t=>t.fromStore?t==null?void 0:t.fromStore:"-"},{field:"toStore",header:"Tujuan Barang",sortable:!1,bodyTemplate:t=>t.toStore?t==null?void 0:t.toStore:"-"}],k=()=>{const t={};if(n.value==="month"){let d=new Date(o.value[0]);d.setDate(d.getDate()+1),d.setHours(0,0,0,0);let s=new Date(o.value[1]);s.setDate(s.getDate()+1),s.setHours(0,0,0,0)}let e=o.value[0],a=o.value[1]?new Date(o.value[1]):new Date(o.value[0]);n.value==="month"&&(e==null||e.setDate(1),a==null||a.setMonth(a.getMonth()+1),a==null||a.setDate(0),a==null||a.setHours(23,59,59,999));const c=[e];a&&c.push(a),t.date=JSON.stringify(c),C.emit("data-table:apply-filter",{tableName:"table-report-product-mutation",filter:t})},w=()=>{var s,h,b,y;const t=new j;let e="";if(o.value&&o.value.length>0){const r=o.value[0],u=o.value[1]||new Date(o.value[0]);n.value==="month"?(console.log(o.value),e=((s=o==null?void 0:o.value)==null?void 0:s.length)>1&&!((h=o==null?void 0:o.value)!=null&&h.includes(null))?`${r.toLocaleDateString("id-ID",{month:"long",year:"numeric"})} - ${u.toLocaleDateString("id-ID",{month:"long",year:"numeric"})}`:r.toLocaleDateString("id-ID",{month:"long",year:"numeric"})):e=((b=o==null?void 0:o.value)==null?void 0:b.length)>1&&!((y=o==null?void 0:o.value)!=null&&y.includes(null))?`${r.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})} - ${u.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})}`:r.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})}t.text("Laporan Barang Mutasi",105,10,{align:"center"}),t.text("Agen Sembako Mbak Endang",105,20,{align:"center"}),t.text(e,105,30,{align:"center"});let a=[];for(const r of g.value){const u=new Date(r.date).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"});for(const f of r.products)a.push({date:u,code:f.code,productName:f.name,totalQty:f.quantity,fromStore:r.fromStore,toStore:r.toStore})}a.map((r,u)=>{p.value.push([u+1,r.date,r.code,r.productName,r.totalQty.toString(),r.fromStore,r.toStore])}),R(t,{head:v.value,body:p.value,styles:{fontSize:9},headStyles:{fillColor:[0,123,255]},margin:{top:40}});const c=t.output("blob"),d=URL.createObjectURL(c);window.open(d),p.value=[]},T=async t=>{var e;try{const{data:a}=await L.getStockMutationReport(t);return g.value=((e=a==null?void 0:a.data)==null?void 0:e.data)||[],a}catch(a){console.error("Error fetching store stock:",a)}};return S(()=>o.value,()=>{p.value=[],v.value=[["No","Tanggal Transaksi","Kode Barang","Barang","Jumlah Barang","Sumber Barang","Tujuan Barang"]]}),S(()=>n.value,()=>{n.value&&(o.value=void 0)},{immediate:!0}),(t,e)=>(P(),A(D,null,{default:J(()=>[l("div",q,[e[7]||(e[7]=l("div",{class:"flex flex-row gap-1 w-fit"},[l("span",{class:"text-lg font-semibold"},"Laporan Barang Mutasi")],-1)),l("div",z,[l("div",E,[l("div",H,[e[5]||(e[5]=l("span",{class:"text-xs"},"Filter Berdasarkan",-1)),l("div",K,[l("div",O,[i(_(x),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),inputId:"date",name:"date",value:"date",size:"small"},null,8,["modelValue"]),e[3]||(e[3]=l("label",{for:"warehouse"},"Tanggal",-1))]),l("div",Q,[i(_(x),{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),inputId:"month",name:"month",value:"month",size:"small"},null,8,["modelValue"]),e[4]||(e[4]=l("label",{for:"store"},"Bulan",-1))])])]),l("div",Y,[l("div",null,[i($,{modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value=a),view:n.value==="date"?"date":"month",dateFormat:n.value==="date"?"dd MM yy":"MM yy",placeholder:n.value==="date"?"Pilih Tanggal Transaksi":"Pilih Bulan & Tahun Transaksi","selection-mode":"range"},null,8,["modelValue","view","dateFormat","placeholder"])]),l("div",null,[i(N,{onClick:k,label:"Terapkan",severity:"primary",class:"text-xs"})])]),l("div",G,[l("button",{onClick:w,class:"text-xs rounded-sm !px-2 !py-1 bg-blue-500 text-white hover:bg-blue-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-blue-600"},[l("div",W,[i(I,{icon:"printer"}),e[6]||(e[6]=l("span",null,"Cetak Laporan",-1))])])])]),i(M,{"data-key":"id","fetch-function":T,columns:B,"use-options":!1,"table-name":"table-report-product-mutation","selection-type":"single","use-paginator":""})])])]),_:1}))}});export{xe as default};
