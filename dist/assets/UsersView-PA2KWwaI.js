import{_ as V}from"./DataTable.vue_vue_type_script_setup_true_lang-DkQ8ZiHB.js";import{U}from"./user.service-xbroNZV8.js";import{f as C}from"./data.utils-eGwCzW_2.js";import{_ as $}from"./Button.vue_vue_type_script_setup_true_lang-rIGgxgcr.js";import{_ as E}from"./ButtonMultiAction.vue_vue_type_script_setup_true_lang-BdajNBCl.js";import{_ as I}from"./DialogConfirm.vue_vue_type_style_index_0_lang-WHPMX5cm.js";import{u as O,v as c,a5 as J,E as H,L,q as M,a6 as j,o as k,c as T,a7 as G,y as f,b as n,N as q,I as _,K as w,D as z,J as K,p as B,w as W,F as Q,r as X,t as Y,x as Z}from"./index-CZcKsIac.js";import{_ as ee}from"./Card.vue_vue_type_script_setup_true_lang-BZXtfgLa.js";import{e as h}from"./index-CFjhT2rJ.js";import{_ as F}from"./DatePicker.vue_vue_type_script_setup_true_lang-DO0hKc8A.js";import{_ as te}from"./MultiSelect.vue_vue_type_script_setup_true_lang-DRDj63ly.js";import{_ as ae,a as se}from"./ButtonSearch.vue_vue_type_script_setup_true_lang-Hc1jAlXZ.js";import"./Icon.vue_vue_type_script_setup_true_lang-IWHSCPZr.js";import"./Animation-BkN-clDC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-RMyfUl0n.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-BWIYknzP.js";import"./index-leh0mV7z.js";import"./index-DmxwpbCv.js";import"./index-ZznVB4pp.js";import"./api.service-DIZ163FT.js";import"./auth.service-CbCeYD79.js";import"./index-Ciazzx3_.js";import"./index-ByLNjECM.js";import"./index-lVtNF93U.js";import"./index-CerbT9b8.js";import"./InputText.vue_vue_type_script_setup_true_lang-C4DK9rPQ.js";const le={class:"!overflow-hidden"},oe={class:"!overflow-hidden"},re={class:"!overflow-hidden"},ie={class:"flex items-end justify-end gap-2","data-wv-section":"filteractionbuttons",style:{"grid-area":"2/4"}},ne=O({inheritAttrs:!1,__name:"UserFilterFields",props:{tableName:{default:"product-table"}},emits:["apply"],setup(P,{emit:S}){const p=c(4),u=c(),m=c([]),s=c([]),l=c([]),i=J(!1),g=c(null),v=P,y=S;H(()=>{N(),h.on("show-filter",b)}),L(()=>{h.off("show-filter",b)});const D=()=>{const r={};if(h.emit("multi-select:hide-overlay"),u.value&&u.value.length>0&&(r.role=JSON.stringify(u.value)),s.value&&s.value.length>0){const a=s.value[0]?new Date(s.value[0]):null,e=s.value[1]?new Date(s.value[1]):new Date(s.value[0]),t=[a];e&&t.push(e),r.updatedAt=JSON.stringify(t)}if(l.value&&l.value.length>0){const a=l.value[0]?new Date(l.value[0]):null,e=l.value[1]?new Date(l.value[1]):new Date(l.value[0]),t=[a];e&&t.push(e),r.createdAt=JSON.stringify(t)}h.emit("data-table:apply-filter",{tableName:v==null?void 0:v.tableName,filter:r}),h.emit("data-table:clear-selected-data",{tableName:v==null?void 0:v.tableName}),y==null||y("apply",r)},x=()=>{u.value=[],s.value=[],l.value=[]},b=r=>{r.tableName===v.tableName&&(i.value=r.show)},N=()=>{if(g.value){const{children:r}=g.value,a=g.value.childElementCount,e=a%p.value;let[t,d]=[1,1];for(const o in Array.from({length:a})){const R=Number(o)===a-1;r[o].setAttribute("style",`grid-area: ${t}/${R&&e?p.value:d}`),++d>p.value&&(d=1,t++)}}},A=async r=>{try{let a={};r==="role"&&(a.role=JSON.stringify(!0));const{data:e}=await U.getUserOptions(a);m.value=e.data.role}catch(a){console.error("Error fetching filter options:",a)}};return(r,a)=>M((k(),T("div",{ref_key:"container",ref:g,class:"grid gap-4 py-2 bg-[#5080e1]/10 rounded-md px-3",style:G(`grid-template-columns: repeat(${p.value}, 1fr)`)},[f("div",le,[n(te,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),options:m.value,onShow:a[1]||(a[1]=e=>A("role")),controls:"",label:"Role",placeholder:"Pilih Role","option-label":"label","option-value":"value"},null,8,["modelValue","options"])]),f("div",oe,[n(F,{"model-value":s.value,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value=e),label:"Terakhir Diubah",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),f("div",re,[n(F,{"model-value":l.value,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value=e),label:"Dibuat Pada",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),f("div",ie,[n($,{onClick:x,label:"Bersihkan Fields","data-wv-section":"clearbutton",severity:"secondary",class:"text-xs"}),n($,{onClick:D,label:"Terapkan Filter","data-wv-section":"applybutton",severity:"success",class:"text-xs"})])],4)),[[j,i.value]])}}),ue={class:"flex flex-col gap-2 text-black"},de={class:"flex flex-col gap-2"},ce={class:"flex flex-row justify-start gap-2"},me={class:"w-full flex justify-end gap-2"},Je=O({__name:"UsersView",setup(P){const S=K(),p=z(),u=q(),m=c(),s=c([]),l=c([]),i=c({visible:!1,header:"",severity:"success",confirmButtonSeverity:"success"}),g=_(()=>[{label:"Detail",icon:"file-info",visible:w("setting_user").view,command:()=>{var e;s.value=[],sessionStorage.setItem("users",String((e=m.value)==null?void 0:e.id)),p.push("/settings/users/detail")}},{label:"Edit",icon:"edit",visible:w("setting_user").update,command:()=>{var e;s.value=[],sessionStorage.setItem("users",String((e=m.value)==null?void 0:e.id)),p.push("/settings/users/edit")}},{label:"Hapus",icon:"delete-bin",danger:!0,visible:w("setting_user").delete&&v.value,command:()=>{l.value=[m.value],i.value={visible:!0,header:"Hapus Pengguna",severity:"error",confirmButtonSeverity:"danger",message:"Apakah kamu yakin ingin menghapus pengguna ini?",list:l.value.map(e=>e.name),confirmLabel:"Hapus",actionable:!0}}}]),v=_(()=>{if(!m.value)return!1;const e=localStorage.getItem("user");if(!e)return!1;const t=JSON.parse(e);return m.value.id!==t.id}),y=_(()=>{if(!s.value||s.value.length===0)return!1;const e=localStorage.getItem("user");if(!e)return!1;const t=JSON.parse(e);return!s.value.some(d=>d.id===t.id)}),D=_(()=>[{label:"Hapus",icon:"delete-bin",danger:!0,visible:w("setting_user").delete&&y.value,command:()=>{l.value=s.value,i.value={visible:!0,header:"Hapus Pengguna",severity:"error",confirmButtonSeverity:"danger",message:"Apakah kamu yakin ingin menghapus pengguna ini?",list:l.value.map(e=>e.name),confirmLabel:"Hapus",actionable:!0}}}]),x=[{header:"Username",field:"username",sortable:!0},{header:"Nama",field:"name",sortable:!0},{header:"Role",field:"roles.name",sortable:!0},{header:"Terakhir Diubah",field:"updatedAt",sortable:!0,bodyTemplate:e=>e.updatedAt?C(new Date(e.updatedAt)):"-"},{header:"Dibuat Pada",field:"createdAt",sortable:!0,bodyTemplate:e=>e.createdAt?C(new Date(e.createdAt)):"-"}],b=_(()=>S.path.split("/").pop()),N=()=>{s.value=[],p.push("/settings/users/add")},A=async()=>{await a(l.value.map(e=>e.id))},r=async e=>{try{const{data:t}=await U.getUserList(e);return t}catch(t){console.error("Error fetching data:",t)}},a=async e=>{var t,d;try{if(e.length===0){u.add({severity:"warn",summary:"Warning",detail:"Tidak ada pengguna yang dipilih untuk dihapus",life:3e3});return}const o={id:e};await U.deleteUser(o),u.add({severity:"success",summary:"Success",detail:"Pengguna berhasil dihapus",life:3e3}),i.value.visible=!1,s.value=[],h.emit("data-table:update",{tableName:"table-user"})}catch(o){console.error("Error deleting user:",o),u.add({severity:"error",summary:"Error",detail:o?(d=(t=o.response)==null?void 0:t.data)==null?void 0:d.message:"Gagal menghapus pengguna",life:3e3})}};return(e,t)=>{const d=X("router-view");return b.value==="add"||b.value==="edit"||b.value==="detail"?(k(),B(d,{key:0})):(k(),T(Q,{key:1},[n(ee,null,{default:W(()=>[f("div",ue,[f("div",de,[f("div",ce,[n(E,{"selected-data":s.value,"onUpdate:selectedData":t[0]||(t[0]=o=>s.value=o),options:D.value,"table-name":"table-user"},null,8,["selected-data","options"]),f("div",me,[n(ae,{"table-name":"table-user"}),n(se,{"table-name":"table-user"}),Z(w)("setting_user").create?(k(),B($,{key:0,onClick:N,label:"Tambah Pengguna",severity:"primary",class:"text-xs"})):Y("",!0)])]),n(ne,{"table-name":"table-user"}),n(V,{"data-key":"id","fetch-function":r,columns:x,options:g.value,onToggleOption:t[1]||(t[1]=o=>m.value=o),"onUpdate:selectedData":t[2]||(t[2]=o=>s.value=o),"table-name":"table-user","selection-type":"checkbox","use-paginator":""},null,8,["options"])])])]),_:1}),n(I,{visible:i.value.visible,"onUpdate:visible":t[3]||(t[3]=o=>i.value.visible=o),onConfirm:A,header:i.value.header,"header-icon":"check",list:i.value.list,message:i.value.message,severity:i.value.severity,"confirm-button-severity":i.value.confirmButtonSeverity},null,8,["visible","header","list","message","severity","confirm-button-severity"])],64))}}});export{Je as default};
