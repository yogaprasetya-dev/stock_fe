import{u as E,N as M,v as d,a6 as B,E as D,p as F,w as N,o as k,y as t,c as g,t as x,b as u,x as w,A as $,F as G,O as K,D as Q}from"./index-BgBP_tks.js";import{_ as R}from"./Card.vue_vue_type_script_setup_true_lang-CUt5fhMy.js";import{_ as q}from"./DatePicker.vue_vue_type_script_setup_true_lang-BvhIWKqB.js";import{_}from"./Dropdown.vue_vue_type_script_setup_true_lang-PH4WxaG-.js";import{_ as z}from"./InputNumber.vue_vue_type_script_setup_true_lang-BQsGDbb8.js";import{_ as J}from"./InputText.vue_vue_type_script_setup_true_lang-DgR1zIqT.js";import{S as I}from"./stock.service-DPguw9Xc.js";import{s as V}from"./index-pFwre4ZI.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-nwuTL028.js";import"./index-CID7Xlg7.js";import"./index-90rlHNJh.js";import"./index-B-ZxyYwg.js";import"./index-Bloi8f6W.js";import"./index-jzyx_aDm.js";import"./index-DWhnuWKD.js";import"./api.service-SYRgDTzX.js";import"./index-D-6hEweM.js";const O={class:"flex items-center gap-10"},j={class:"w-full"},A={class:"w-full"},L={class:"flex items-center gap-10"},H={class:"w-full"},X={class:"flex gap-4 py-1 !text-xs cursor-not-allowed"},Y={class:"flex items-center gap-2"},Z={class:"flex items-center gap-2"},ee={key:0,class:"w-full"},ae={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},te={class:"w-full"},oe={class:"w-full"},we=E({__name:"ProductInEditView",setup(le){const S=Q(),l=M(),c=d(),i=d(),s=d(),v=d(),p=d([]),n=d([]),f=B(0),b=d();D(()=>{W()});const P=()=>{n.value=[],i.value=void 0},y=()=>{S.back()},W=async()=>{var m,e;try{const a=sessionStorage.getItem("productIn");if(!a){l.add({severity:"warn",summary:"Warning",detail:"Tidak ada data produk masuk yang ditemukan",life:3e3});return}const{data:o}=await I.getStockInById(Number(a));b.value=o.data,c.value=o.data.transactionCode,i.value=new Date(o.data.date),s.value=o.data.toWarehouse?"warehouse":"store",v.value=o.data.toWarehouse?void 0:{id:(m=o.data.toStore)==null?void 0:m.id,name:(e=o.data.toStore)==null?void 0:e.name},o.data.products.forEach(h=>{p.value.push({id:h.id,name:h.name}),n.value.push(h.quantity)}),f.value=o.data.products.length}catch(a){console.error("Error fetching product in:",a),l.add({severity:"error",summary:"Error",detail:"Gagal mengambil data produk masuk",life:3e3})}},T=async()=>{var m,e,a;try{if(!c.value||!i.value){l.add({severity:"warn",summary:"Warning",detail:"Kode transaksi dan tanggal diperlukan",life:3e3});return}if(s.value!=="warehouse"&&!v.value){l.add({severity:"warn",summary:"Warning",detail:"Jika tidak masuk ke gudang, pilih toko terlebih dahulu",life:3e3});return}if(p.value.filter(r=>r!==void 0&&r.id!==void 0).length!==f.value){l.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(n.value.filter(r=>r!==void 0&&r>0).length!==f.value){l.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}const U={transactionCode:c.value,date:(m=i.value)==null?void 0:m.toISOString(),toWarehouse:s.value==="warehouse",storeId:((e=v.value)==null?void 0:e.id)??null,products:p.value.map((r,C)=>({id:r.id,quantity:n.value[C]}))};await I.updateStockIn((a=b.value)==null?void 0:a.id,U),l.add({severity:"success",summary:"Success",detail:"Stok masuk berhasil diperbarui",life:3e3}),y()}catch(o){console.error("Error updating stock in:",o),l.add({severity:"error",summary:"Error",detail:"Gagal memperbarui stok masuk",life:3e3})}};return(m,e)=>(k(),F(R,null,{default:N(()=>[t("form",{class:"flex flex-col p-4 gap-3",onSubmit:K(T,["prevent"])},[t("div",O,[t("div",j,[u(J,{"model-value":c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),t("div",A,[u(q,{"model-value":i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),t("div",L,[t("div",H,[e[7]||(e[7]=t("span",{class:"text-xs"},"Masuk ke Gudang / Toko",-1)),t("div",X,[t("div",Y,[u(w(V),{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value=a),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small",disabled:""},null,8,["modelValue"]),e[5]||(e[5]=t("label",{for:"warehouse"},"Gudang",-1))]),t("div",Z,[u(w(V),{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value=a),inputId:"store",name:"toWarehouse",value:"store",size:"small",disabled:""},null,8,["modelValue"]),e[6]||(e[6]=t("label",{for:"store"},"Toko",-1))])])]),s.value==="store"?(k(),g("div",ee,[u(_,{"model-value":v.value,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value=a),placeholder:"Pilih Toko",label:"Toko","disabled-button":""},null,8,["model-value"])])):x("",!0)]),f.value>0?(k(!0),g(G,{key:0},$(f.value,a=>(k(),g("div",{key:a,class:"flex items-center gap-4 pt-2 w-full"},[t("div",ae,[t("div",te,[u(_,{"model-value":p.value[a-1],"onUpdate:modelValue":o=>p.value[a-1]=o,placeholder:"Pilih Produk",label:"Produk","disabled-button":""},null,8,["model-value","onUpdate:modelValue"])]),t("div",oe,[u(z,{"model-value":n.value[a-1],"onUpdate:modelValue":o=>n.value[a-1]=o,placeholder:"Jumlah",label:"Quantity",max:1e3},null,8,["model-value","onUpdate:modelValue"])])])]))),128)):x("",!0),t("div",{class:"flex justify-end pt-8"},[t("div",{class:"flex flex-col gap-4 items-end"},[t("div",{class:"flex gap-2"},[t("button",{type:"button",onClick:y,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),t("button",{type:"button",onClick:P,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[8]||(e[8]=t("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{we as default};
