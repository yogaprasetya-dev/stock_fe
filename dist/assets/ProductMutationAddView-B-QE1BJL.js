import{u as ee,N as ae,v as r,a5 as te,E as oe,M as F,p as le,w as se,o as w,y as a,c as T,t as N,b as u,x as j,P as re,A as ne,z as ie,F as ue,O as de,D as ce}from"./index-DuqMkg4i.js";import{_ as ve}from"./Card.vue_vue_type_script_setup_true_lang-B8PURPzj.js";import{_ as me}from"./Checkbox.vue_vue_type_script_setup_true_lang-BzWzbJP8.js";import{_ as pe}from"./DatePicker.vue_vue_type_script_setup_true_lang-hjH7K3e2.js";import{_ as W}from"./Dropdown.vue_vue_type_script_setup_true_lang-B7n7CyQj.js";import{_ as G}from"./Icon.vue_vue_type_script_setup_true_lang-DIZdKOaf.js";import{_ as fe}from"./InputNumber.vue_vue_type_script_setup_true_lang-5pLZKIjO.js";import{_ as ge}from"./InputText.vue_vue_type_script_setup_true_lang-3JzyQCM6.js";import{S as x}from"./stock.service-FGM5fSqI.js";import{S as he}from"./store.service-CrKhYW4B.js";import{d as be}from"./data.utils-eGwCzW_2.js";import{s as Q}from"./index-DluFaCjb.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-BKnS3hZE.js";import"./index-DSPpt8Dk.js";import"./index-CxOcdtD_.js";import"./index-BuCuFxRa.js";import"./index-BJdiuMEp.js";import"./index-DunXWRsd.js";import"./index-DwN_o03U.js";import"./api.service-C54YsUjA.js";import"./index-D3QVXGA5.js";const ye={class:"flex items-center gap-10"},ke={class:"w-full"},we={class:"w-full"},xe={class:"flex items-center gap-10 w-full"},_e={class:"w-full"},Se={class:"flex gap-4 py-1 !text-xs"},Ve={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},Te={key:0,class:"grid grid-cols-2 w-full pr-10"},We={class:"grid grid-cols-2 pr-10 w-full"},Me={class:"flex items-center gap-10 pt-2"},Ce={class:"w-[460px]"},Ue={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},$e={class:"w-full"},Ie={class:"w-[30%] flex flex-col gap-2"},Be={class:"text-xs text-center"},De={class:"w-full"},Oe={class:"h-full flex items-end"},Ee={class:"w-[30px]"},qe=["onClick"],Fe={class:"flex justify-end pt-8"},Ne={class:"flex flex-col gap-4 items-end"},da=ee({__name:"ProductMutationAddView",setup(je){const z=ce(),i=ae(),f=r(),c=r(),v=r(),g=r(),n=r([]),_=r([]),S=r(),p=r([]),b=r(!1),d=te(0),M=r(0),C=r([]),U=r([]),h=r([]),s=r();oe(()=>{c.value=new Date,k()});const H=()=>{d.value+=1,y()},J=t=>{d.value>0&&(d.value-=1,n.value.splice(t,1),p.value.splice(t,1),y())},$=()=>{f.value=void 0,c.value=void 0,v.value=void 0,g.value=void 0,n.value=[],p.value=[],b.value=!1,d.value=0,c.value=void 0,y()},I=()=>{z.back()},B=async()=>{try{const{data:t}=await he.getStoreDropdown();S.value=t.data}catch(t){console.error("Error fetching store options:",t)}},y=()=>{f.value=be(M.value)},K=t=>{if(n.value[t]){if(s.value==="warehouse"){const e=U.value.find(o=>o.id===n.value[t].id);h.value[t]=(e==null?void 0:e.quantity)??0}else if(s.value==="store"){const e=C.value.find(o=>o.product.id===n.value[t].id);h.value[t]=(e==null?void 0:e.quantity)??0}}else h.value[t]=0},k=async()=>{try{const{data:t}=await x.getStockMutationIndex();M.value=t.data.nextCode,y()}catch(t){console.error("Error fetching stock in index:",t)}},R=async()=>{s.value=="store"?await L():s.value=="warehouse"&&await A()},A=async()=>{try{const{data:t}=await x.getWarehouseStockDropdown();U.value=t.data,_.value=t.data.map(e=>({id:e.id,name:e.name}))}catch(t){console.error("Error fetching warehouse stock:",t)}},L=async()=>{try{if(!v.value)return;const{data:t}=await x.getStoreStockById(v.value.id);C.value=t.data,_.value=t.data.map(e=>({id:e.product.id,name:e.product.name}))}catch(t){console.error("Error fetching store stock:",t)}},X=async()=>{var t,e,o,m,D,O,E;try{if(!f.value||!c.value){i.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!s.value){i.add({severity:"warn",summary:"Warning",detail:"Pilih sumber barang (Gudang/Toko)",life:3e3});return}if(s.value==="store"&&!v.value){i.add({severity:"warn",summary:"Warning",detail:"Pilih gudang sumber barang",life:3e3});return}if(!g.value){i.add({severity:"warn",summary:"Warning",detail:"Pilih toko tujuan barang",life:3e3});return}if(d.value===0){i.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(n.value.filter(l=>l!==void 0&&l.id!==void 0).length!==d.value){i.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(p.value.filter(l=>l!==void 0&&l>0).length!==d.value){i.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}for(let l=0;l<n.value.length;l++){const P=n.value[l],Z=p.value[l],q=h.value[l];if(Z>q){i.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${P.name} tidak boleh lebih dari stok yang tersedia (${q})`,life:3e3});return}}if(s.value==="store"&&((t=v.value)==null?void 0:t.id)===((e=g.value)==null?void 0:e.id)){i.add({severity:"warn",summary:"Warning",detail:"Sumber barang dan tujuan barang tidak boleh sama",life:3e3});return}const Y={transactionCode:f.value,date:(o=c.value)==null?void 0:o.toISOString(),fromWarehouse:s.value==="warehouse",fromStoreId:s.value==="store"?(m=v.value)==null?void 0:m.id:null,toStoreId:(D=g.value)==null?void 0:D.id,products:n.value.map((l,P)=>({productId:l==null?void 0:l.id,quantity:p.value[P]}))};await x.postStockMutation(Y),i.add({severity:"success",summary:"Success",detail:"Barang mutasi berhasil dibuat",life:3e3}),b.value?$():(I(),k())}catch(V){i.add({severity:"error",summary:"Error",detail:V?(E=(O=V.response)==null?void 0:O.data)==null?void 0:E.message:"Gagal membuat barang mutasi",life:3e3})}};return F(()=>n.value,()=>{k()},{immediate:!0}),F(()=>c.value,()=>{k()},{immediate:!0}),(t,e)=>(w(),le(ve,null,{default:se(()=>[a("form",{class:"flex flex-col p-4 gap-3",onSubmit:de(X,["prevent"])},[a("div",ye,[a("div",ke,[u(ge,{"model-value":f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),a("div",we,[u(pe,{"model-value":c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),a("div",xe,[a("div",_e,[e[9]||(e[9]=a("span",{class:"text-xs"},"Dari Gudang/Toko",-1)),a("div",Se,[a("div",Ve,[u(j(Q),{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value=o),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small"},null,8,["modelValue"]),e[7]||(e[7]=a("label",{for:"warehouse"},"Gudang",-1))]),a("div",Pe,[u(j(Q),{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value=o),inputId:"store",name:"toWarehouse",value:"store",size:"small"},null,8,["modelValue"]),e[8]||(e[8]=a("label",{for:"store"},"Toko",-1))])])])]),s.value==="store"?(w(),T("div",Te,[u(W,{"model-value":v.value,"onUpdate:modelValue":e[4]||(e[4]=o=>v.value=o),placeholder:"Pilih Toko",label:"Sumber Barang",options:S.value,onOpen:B},null,8,["model-value","options"])])):N("",!0),a("div",We,[u(W,{"model-value":g.value,"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),placeholder:"Pilih Toko",label:"Tujuan Barang",options:S.value,onOpen:B},null,8,["model-value","options"])]),a("div",Me,[a("div",Ce,[a("button",{type:"button",onClick:H,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[e[10]||(e[10]=re(" Tambah Produk ")),u(G,{icon:"add"})])])]),d.value>0?(w(!0),T(ue,{key:1},ne(d.value,o=>(w(),T("div",{key:o,class:"flex items-center gap-4 pt-2 w-full"},[a("div",Ue,[a("div",$e,[u(W,{"model-value":n.value[o-1],"onUpdate:modelValue":m=>n.value[o-1]=m,placeholder:"Pilih Produk",label:"Produk",options:_.value,onHide:m=>K(o-1),onOpen:R},null,8,["model-value","onUpdate:modelValue","options","onHide"])]),a("div",Ie,[e[11]||(e[11]=a("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),a("span",Be,ie(h.value[o-1]?h.value[o-1]:"-"),1)]),a("div",De,[u(fe,{"model-value":p.value[o-1],"onUpdate:modelValue":m=>p.value[o-1]=m,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),a("div",Oe,[a("div",Ee,[a("button",{type:"button",onClick:m=>J(o-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[u(G,{icon:"delete-bin"})],8,qe)])])])]))),128)):N("",!0),e[13]||(e[13]=a("div",null,null,-1)),a("div",Fe,[a("div",Ne,[u(me,{"model-value":b.value,"onUpdate:modelValue":e[6]||(e[6]=o=>b.value=o),label:"Tetap di sini?"},null,8,["model-value"]),a("div",{class:"flex gap-2"},[a("button",{type:"button",onClick:I,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),a("button",{type:"button",onClick:$,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[12]||(e[12]=a("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{da as default};
