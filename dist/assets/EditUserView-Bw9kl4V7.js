import{u as C,N as D,v as o,E as F,p as P,w as G,o as O,y as s,b as v,O as K,D as j}from"./index-C0yGrXwc.js";import{_ as z}from"./Card.vue_vue_type_script_setup_true_lang-Di5ffkTV.js";import{_ as T}from"./Dropdown.vue_vue_type_script_setup_true_lang-DQAvz-Qq.js";import{_ as q}from"./FileUpload.vue_vue_type_style_index_0_lang-Cligurw2.js";import{_ as A}from"./InputPassword.vue_vue_type_script_setup_true_lang-Beo3IXfq.js";import{_ as g}from"./InputText.vue_vue_type_script_setup_true_lang-DZImwAWb.js";import{U as W}from"./user.service-MIb30XOk.js";import{R as H}from"./role.service-B0tRItju.js";import"./index-D9LLXCNd.js";import"./index-dKs-Fznz.js";import"./index-BT11fFDK.js";import"./index-CCFOWCxn.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-BzzT7Jae.js";import"./index-D1FSZUOy.js";import"./index-Dq8y76Ai.js";import"./index-MGwmnnen.js";import"./Icon.vue_vue_type_script_setup_true_lang-CN-Nob9-.js";import"./Image.vue_vue_type_script_setup_true_lang-C82nboof.js";import"./index-DVVDiDAc.js";import"./index-2cB9bBNy.js";import"./api.service-BWBnNUoO.js";const J={class:"grid grid-cols-2 gap-2"},L={class:"pr-4"},Q={class:""},X={class:"pr-4"},Y={class:""},Z={class:"flex flex-col gap-2 pr-4"},we=C({__name:"EditUserView",setup(M){const r=D(),N=j(),f=o();F(()=>{I(),B(),h()});const n=o(),u=o(),d=o(),t=o(),a=o(),c=o(),m=o(),R=o(),y=o(),I=()=>{const i=sessionStorage.getItem("users");i&&(f.value=Number(i))},b=()=>{N.push("/settings/users")},S=()=>{n.value=void 0,u.value=void 0,d.value=void 0,t.value=void 0,a.value=void 0,m.value=void 0},B=async()=>{try{const i=sessionStorage.getItem("users");if(!i){r.add({severity:"error",summary:"Error",detail:"ID pengguna tidak ditemukan",life:3e3});return}const{data:e}=await W.getUserDetail(Number(i));R.value=e.data.id,n.value=e.data.name,u.value=e.data.username,d.value=e.data.email,c.value=e.data.photo||"",m.value={name:e.data.roles.name,id:e.data.roles.id}}catch(i){console.error("Error fetching user:",i),r.add({severity:"error",summary:"Error",detail:"Gagal memuat data pengguna",life:3e3})}},h=async()=>{try{const{data:i}=await H.getRoleDropdown();y.value=i.data}catch{r.add({severity:"error",summary:"Error",detail:"Gagal memuat data role",life:3e3})}},$=async()=>{var i,e,l,k,w,x,_,U,V,E;try{if(!n.value){r.add({severity:"warn",summary:"Warning",detail:"Nama harus diisi",life:3e3});return}if(!u.value){r.add({severity:"warn",summary:"Warning",detail:"Username harus diisi",life:3e3});return}if(!d.value){r.add({severity:"warn",summary:"Warning",detail:"Email harus diisi",life:3e3});return}if(!m.value){r.add({severity:"warn",summary:"Warning",detail:"Role harus dipilih",life:3e3});return}if(((i=n==null?void 0:n.value)==null?void 0:i.length)>50){r.add({severity:"warn",summary:"Warning",detail:"Nama tidak boleh lebih dari 50 karakter",life:3e3});return}if(((e=u==null?void 0:u.value)==null?void 0:e.length)>15){r.add({severity:"warn",summary:"Warning",detail:"Username tidak boleh lebih dari 15 karakter",life:3e3});return}if(((l=d==null?void 0:d.value)==null?void 0:l.length)>50){r.add({severity:"warn",summary:"Warning",detail:"Email tidak boleh lebih dari 50 karakter",life:3e3});return}if(t!=null&&t.value&&((k=t==null?void 0:t.value)==null?void 0:k.length)<6){r.add({severity:"warn",summary:"Warning",detail:"Password harus minimal 6 karakter",life:3e3});return}if(t!=null&&t.value&&((w=t==null?void 0:t.value)==null?void 0:w.length)>100){r.add({severity:"warn",summary:"Warning",detail:"Password tidak boleh lebih dari 100 karakter",life:3e3});return}if(a!=null&&a.value&&((x=a==null?void 0:a.value)==null?void 0:x.size)>6e5){r.add({severity:"warn",summary:"Warning",detail:"Ukuran foto tidak boleh lebih dari 600KB",life:3e3});return}if(a!=null&&a.value&&!((_=a==null?void 0:a.value)!=null&&_.type.startsWith("image/"))){r.add({severity:"warn",summary:"Warning",detail:"File yang diunggah harus berupa gambar",life:3e3});return}const p={name:n.value,username:u.value,email:d.value,password:t.value,photo:a.value?a.value:null,role:(U=m.value)==null?void 0:U.id};await W.updateUser(f==null?void 0:f.value,p),r.add({severity:"success",summary:"Success",detail:"Pengguna berhasil diperbarui",life:3e3}),b()}catch(p){console.error("Error updating user:",p),r.add({severity:"error",summary:"Error",detail:p?(E=(V=p.response)==null?void 0:V.data)==null?void 0:E.message:"Gagal memperbarui pengguna",life:3e3})}};return(i,e)=>(O(),P(z,null,{default:G(()=>[s("form",{class:"flex flex-col",onSubmit:K($,["prevent"])},[s("div",J,[s("div",L,[v(g,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),label:"Nama",placeholder:"Masukkan nama"},null,8,["modelValue"])]),s("div",Q,[v(g,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l),label:"Username",placeholder:"Masukkan username"},null,8,["modelValue"])]),s("div",X,[v(g,{"model-value":d.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value=l),label:"Email",placeholder:"Masukkan Email",type:"email"},null,8,["model-value"])]),s("div",Y,[v(A,{"model-value":t.value,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value=l),mandatory:!1,label:"Password Baru",placeholder:"Masukkan password"},null,8,["model-value"])]),s("div",Z,[v(T,{"model-value":m.value,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value=l),label:"Role",options:y.value,onOpen:h},null,8,["model-value","options"]),v(q,{"model-value":a.value,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value=l),url:c.value,mandatory:!1,label:"Foto",onUpload:e[6]||(e[6]=l=>a.value=l)},null,8,["model-value","url"])])]),s("div",{class:"flex justify-end pt-8"},[s("div",{class:"flex flex-col gap-4 items-end"},[s("div",{class:"flex gap-2"},[s("button",{type:"button",onClick:b,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),s("button",{type:"button",onClick:S,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[7]||(e[7]=s("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{we as default};
