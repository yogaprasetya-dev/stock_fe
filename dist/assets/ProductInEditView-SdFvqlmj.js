import{_ as E}from"./api.service-Dgs1boU1.js";import{_ as M}from"./DatePicker.vue_vue_type_script_setup_true_lang-DWsIWa76.js";import{_ as x}from"./Dropdown.vue_vue_type_script_setup_true_lang-6IRzW13W.js";import{_ as B}from"./InputNumber.vue_vue_type_script_setup_true_lang-DaGHc2o6.js";import{_ as F}from"./InputText.vue_vue_type_script_setup_true_lang-e6c03x4O.js";import{S as w}from"./stock.service-C4NW6Gnu.js";import{u as $,M as D,v as d,a5 as G,y as K,p as N,w as z,o as k,z as t,c as g,t as _,b as u,x as I,C as Q,F as R,E as q}from"./index-DOh3iN_U.js";import{s as V}from"./index-BDjMOC8z.js";import"./auth.service-BxJEy6Ur.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-DO9keWeT.js";import"./index-HQkD5G-S.js";import"./index-CC8nIHWH.js";import"./index-__IG_7Gg.js";import"./index-LYmElTQ-.js";import"./index-4eifDWYF.js";import"./index-QsIXXSH_.js";const J={class:"flex flex-col p-4 gap-3"},j={class:"flex items-center gap-10"},L={class:"w-full"},O={class:"w-full"},A={class:"flex items-center gap-10"},H={class:"w-full"},X={class:"flex gap-4 py-1 !text-xs cursor-not-allowed"},Y={class:"flex items-center gap-2"},Z={class:"flex items-center gap-2"},ee={key:0,class:"w-full"},ae={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},te={class:"w-full"},oe={class:"w-full"},xe=$({__name:"ProductInEditView",setup(le){const S=q(),l=D(),c=d(),i=d(),s=d(),v=d(),p=d([]),n=d([]),f=G(0),b=d();K(()=>{W()});const P=()=>{n.value=[],i.value=void 0},y=()=>{S.back()},W=async()=>{var m,a;try{const e=sessionStorage.getItem("productIn");if(!e){l.add({severity:"warn",summary:"Warning",detail:"Tidak ada data produk masuk yang ditemukan",life:3e3});return}const{data:o}=await w.getStockInById(Number(e));b.value=o.data,c.value=o.data.transactionCode,i.value=new Date(o.data.date),s.value=o.data.toWarehouse?"warehouse":"store",v.value=o.data.toWarehouse?void 0:{id:(m=o.data.toStore)==null?void 0:m.id,name:(a=o.data.toStore)==null?void 0:a.name},o.data.products.forEach(h=>{p.value.push({id:h.id,name:h.name}),n.value.push(h.quantity)}),f.value=o.data.products.length}catch(e){console.error("Error fetching product in:",e),l.add({severity:"error",summary:"Error",detail:"Gagal mengambil data produk masuk",life:3e3})}},C=async()=>{var m,a,e;try{if(!c.value||!i.value){l.add({severity:"warn",summary:"Warning",detail:"Kode transaksi dan tanggal diperlukan",life:3e3});return}if(s.value!=="warehouse"&&!v.value){l.add({severity:"warn",summary:"Warning",detail:"Jika tidak masuk ke gudang, pilih toko terlebih dahulu",life:3e3});return}if(p.value.filter(r=>r!==void 0&&r.id!==void 0).length!==f.value){l.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(n.value.filter(r=>r!==void 0&&r>0).length!==f.value){l.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}const T={transactionCode:c.value,date:(m=i.value)==null?void 0:m.toISOString(),toWarehouse:s.value==="warehouse",storeId:((a=v.value)==null?void 0:a.id)??null,products:p.value.map((r,U)=>({id:r.id,quantity:n.value[U]}))};await w.updateStockIn((e=b.value)==null?void 0:e.id,T),l.add({severity:"success",summary:"Success",detail:"Stok masuk berhasil diperbarui",life:3e3}),y()}catch(o){console.error("Error updating stock in:",o),l.add({severity:"error",summary:"Error",detail:"Gagal memperbarui stok masuk",life:3e3})}};return(m,a)=>(k(),N(E,null,{default:z(()=>[t("div",J,[t("div",j,[t("div",L,[u(F,{"model-value":c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),t("div",O,[u(M,{"model-value":i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),t("div",A,[t("div",H,[a[7]||(a[7]=t("span",{class:"text-xs"},"Masuk ke Gudang / Toko",-1)),t("div",X,[t("div",Y,[u(I(V),{modelValue:s.value,"onUpdate:modelValue":a[2]||(a[2]=e=>s.value=e),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small",disabled:""},null,8,["modelValue"]),a[5]||(a[5]=t("label",{for:"warehouse"},"Gudang",-1))]),t("div",Z,[u(I(V),{modelValue:s.value,"onUpdate:modelValue":a[3]||(a[3]=e=>s.value=e),inputId:"store",name:"toWarehouse",value:"store",size:"small",disabled:""},null,8,["modelValue"]),a[6]||(a[6]=t("label",{for:"store"},"Toko",-1))])])]),s.value==="store"?(k(),g("div",ee,[u(x,{"model-value":v.value,"onUpdate:modelValue":a[4]||(a[4]=e=>v.value=e),placeholder:"Pilih Toko",label:"Toko","disabled-button":""},null,8,["model-value"])])):_("",!0)]),f.value>0?(k(!0),g(R,{key:0},Q(f.value,e=>(k(),g("div",{key:e,class:"flex items-center gap-4 pt-2 w-full"},[t("div",ae,[t("div",te,[u(x,{"model-value":p.value[e-1],"onUpdate:modelValue":o=>p.value[e-1]=o,placeholder:"Pilih Produk",label:"Produk","disabled-button":""},null,8,["model-value","onUpdate:modelValue"])]),t("div",oe,[u(B,{"model-value":n.value[e-1],"onUpdate:modelValue":o=>n.value[e-1]=o,placeholder:"Jumlah",label:"Quantity",max:1e3},null,8,["model-value","onUpdate:modelValue"])])])]))),128)):_("",!0),t("div",{class:"flex justify-end pt-8"},[t("div",{class:"flex flex-col gap-4 items-end"},[t("div",{class:"flex gap-2"},[t("button",{onClick:y,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),t("button",{onClick:P,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),t("button",{onClick:C,class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ")])])])])]),_:1}))}});export{xe as default};
