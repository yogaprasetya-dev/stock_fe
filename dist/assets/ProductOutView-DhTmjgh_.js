import{_ as $}from"./Button.vue_vue_type_script_setup_true_lang-DbzuTa2R.js";import{_ as E}from"./Card.vue_vue_type_script_setup_true_lang-Di5ffkTV.js";import{_ as V}from"./DataTable.vue_vue_type_script_setup_true_lang-DJvYUo94.js";import{_ as L}from"./DialogConfirm.vue_vue_type_style_index_0_lang-DEojbJcB.js";import{f as N}from"./data.utils-eGwCzW_2.js";import{u as G,v as f,a5 as U,E as J,L as H,q as M,a6 as j,o as B,c as R,a7 as q,y as b,b as m,N as z,I,K as S,D as Q,J as W,p as K,w as X,F as Y,r as Z,t as ee,x as ae}from"./index-C0yGrXwc.js";import{S as C}from"./stock.service-BwhD04wV.js";import{_ as te,a as re}from"./ButtonSearch.vue_vue_type_script_setup_true_lang-Kg9KZkbX.js";import{_ as O}from"./DatePicker.vue_vue_type_script_setup_true_lang-B_QhfVSi.js";import{e as y}from"./index-CFjhT2rJ.js";import{_ as le}from"./Badge.vue_vue_type_script_setup_true_lang-Dv23P0XT.js";import"./Icon.vue_vue_type_script_setup_true_lang-CN-Nob9-.js";import"./Animation-D57kF8FT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BO3ijiw2.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-BzzT7Jae.js";import"./index-D9LLXCNd.js";import"./index-dKs-Fznz.js";import"./index-BT11fFDK.js";import"./index-D1FSZUOy.js";import"./index-Dq8y76Ai.js";import"./index-2cB9bBNy.js";import"./api.service-BWBnNUoO.js";import"./index-MGwmnnen.js";import"./InputText.vue_vue_type_script_setup_true_lang-DZImwAWb.js";const se={class:"flex items-end justify-end gap-2","data-wv-section":"filteractionbuttons",style:{"grid-area":"2/4"}},oe=G({inheritAttrs:!1,__name:"ProductOutFilterFields",props:{tableName:{default:"product-table"}},emits:["apply"],setup(P,{emit:w}){const h=f(4),o=f([]),a=f([]),c=f([]),g=U(!1),r=f(null),v=P,k=w;J(()=>{A(),y.on("show-filter",_)}),H(()=>{y.off("show-filter",_)});const T=()=>{const u={};if(y.emit("multi-select:hide-overlay"),o.value&&o.value.length>0){const l=o.value[0]?new Date(o.value[0]):null,s=o.value[1]?new Date(o.value[1]):new Date(o.value[0]),d=[l];s&&d.push(s),u.date=JSON.stringify(d)}if(a.value&&a.value.length>0){const l=a.value[0]?new Date(a.value[0]):null,s=a.value[1]?new Date(a.value[1]):new Date(a.value[0]),d=[l];s&&d.push(s),u.updatedAt=JSON.stringify(d)}if(c.value&&c.value.length>0){const l=c.value[0]?new Date(c.value[0]):null,s=c.value[1]?new Date(c.value[1]):new Date(c.value[0]),d=[l];s&&d.push(s),u.createdAt=JSON.stringify(d)}y.emit("data-table:apply-filter",{tableName:v==null?void 0:v.tableName,filter:u}),y.emit("data-table:clear-selected-data",{tableName:v==null?void 0:v.tableName}),k==null||k("apply",u)},x=()=>{o.value=[],a.value=[],c.value=[]},_=u=>{u.tableName===v.tableName&&(g.value=u.show)},A=()=>{if(r.value){const{children:u}=r.value,l=r.value.childElementCount,s=l%h.value;let[d,e]=[1,1];for(const t in Array.from({length:l})){const n=Number(t)===l-1;u[t].setAttribute("style",`grid-area: ${d}/${n&&s?h.value:e}`),++e>h.value&&(e=1,d++)}}};return(u,l)=>M((B(),R("div",{ref_key:"container",ref:r,class:"grid gap-4 py-2 bg-[#5080e1]/10 rounded-md px-3",style:q(`grid-template-columns: repeat(${h.value}, 1fr)`)},[b("div",null,[m(O,{"model-value":o.value,"onUpdate:modelValue":l[0]||(l[0]=s=>o.value=s),label:"Tanggal Transaksi",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),b("div",null,[m(O,{"model-value":a.value,"onUpdate:modelValue":l[1]||(l[1]=s=>a.value=s),label:"Terakhir Diubah",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),b("div",null,[m(O,{"model-value":c.value,"onUpdate:modelValue":l[2]||(l[2]=s=>c.value=s),label:"Dibuat Pada",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),b("div",se,[m($,{onClick:x,label:"Bersihkan Fields","data-wv-section":"clearbutton",severity:"secondary",class:"text-xs"}),m($,{onClick:T,label:"Terapkan Filter","data-wv-section":"applybutton",severity:"success",class:"text-xs"})])],4)),[[j,g.value]])}}),ie={class:"flex flex-col gap-2 text-black"},ne={class:"flex flex-col gap-2"},ue={class:"flex flex-row justify-start gap-2"},de={class:"w-full flex justify-end gap-2"},Ke=G({__name:"ProductOutView",setup(P){const w=Q(),h=W(),o=z(),a=f(),c=f([]),g=f([]),r=f({visible:!1,header:"",severity:"success",confirmButtonSeverity:"success"}),v=I(()=>{var e,t,n;return[{label:"Edit",icon:"edit",visible:((e=a==null?void 0:a.value)==null?void 0:e.status)!=="completed"&&S("product_out").update,command:()=>{var p,D,F;const i={id:(p=a==null?void 0:a.value)==null?void 0:p.id,fromStoreId:(F=(D=a==null?void 0:a.value)==null?void 0:D.fromStore)==null?void 0:F.id};sessionStorage.setItem("productOut",JSON.stringify(i)),w.push("/manage-product/product-out/edit")}},{label:"Tandai Selesai",icon:"check",visible:((t=a==null?void 0:a.value)==null?void 0:t.status)!=="completed"&&S("product_out").update,command:()=>{g.value=[a.value],r.value={visible:!0,header:"Tandai Barang Keluar Selesai",severity:"success",confirmButtonSeverity:"success",message:"Apakah kamu yakin ingin menandai barang keluar ini sebagai selesai?",list:g.value.map(i=>i.transactionCode),confirmLabel:"Tandai Selesai",actionable:!0}}},{label:"Hapus",icon:"delete-bin",danger:!0,visible:((n=a==null?void 0:a.value)==null?void 0:n.status)!=="completed"&&S("product_out").delete,command:()=>{g.value=[a.value],r.value={visible:!0,header:"Hapus Barang Keluar",severity:"error",confirmButtonSeverity:"danger",message:"Apakah kamu yakin ingin menghapus barang keluar ini?",list:g.value.map(i=>i.transactionCode),confirmLabel:"Hapus",actionable:!0}}}]}),k=e=>{switch(e){case"completed":return"Selesai";default:return"Pending"}},T=e=>{switch(e){case"completed":return"success";default:return"warning"}},x=[{header:"Kode Transaksi",field:"transactionCode",sortable:!0},{header:"Tanggal Transaksi",field:"date",sortable:!0,bodyTemplate:e=>e.date?N(new Date(e.date)):"-"},{header:"Status",field:"status",sortable:!0,bodyComponent:e=>({component:le,props:{label:k(e.status),severity:T(e.status)}})},{header:"Barang",field:"product.name",sortable:!0,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(n=>({value:`${n.name}`}))}}},{header:"Qty",field:"product.quantity",sortable:!0,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(n=>({value:`${n.quantity}`}))}}},{header:"Sumber Barang",field:"fromStore.name",sortable:!0,bodyTemplate:e=>e.fromStore?e.fromStore.name:"Gudang"},{header:"Terakhir Diubah",field:"updatedAt",sortable:!0,bodyTemplate:e=>e.updatedAt?N(new Date(e.updatedAt)):"-"},{header:"Dibuat Pada",field:"createdAt",sortable:!0,bodyTemplate:e=>e.createdAt?N(new Date(e.createdAt)):"-"}],_=I(()=>h.path.split("/").pop()),A=()=>{w.push("/manage-product/product-out/add")},u=async()=>{r.value.header==="Hapus Barang Keluar"?await d():r.value.header==="Tandai Barang Keluar Selesai"&&await s()},l=async e=>{try{const{data:t}=await C.getStockOut(e);return t}catch(t){console.error("Error fetching data:",t)}},s=async()=>{var e,t,n,i;try{if(!((e=a.value)!=null&&e.id)){o.add({severity:"error",summary:"Gagal",detail:"ID barang keluar tidak ditemukan.",life:3e3});return}await C.patchStockOut((t=a==null?void 0:a.value)==null?void 0:t.id),o.add({severity:"success",summary:"Berhasil",detail:"Barang keluar berhasil ditandai sebagai selesai.",life:3e3}),r.value.visible=!1,a.value=void 0,y.emit("data-table:update",{tableName:"table-product-out"})}catch(p){console.error("Error verifying stock out:",p),o.add({severity:"error",summary:"Gagal",detail:p?(i=(n=p.response)==null?void 0:n.data)==null?void 0:i.message:"Gagal menandai barang keluar.",life:3e3})}},d=async()=>{var e,t,n,i;try{if(!((e=a.value)!=null&&e.id)){o.add({severity:"error",summary:"Gagal",detail:"ID barang Keluar tidak ditemukan.",life:3e3});return}await C.deleteStockOut((t=a==null?void 0:a.value)==null?void 0:t.id),o.add({severity:"success",summary:"Berhasil",detail:"Barang Keluar berhasil dihapus.",life:3e3}),r.value.visible=!1,a.value=void 0,y.emit("data-table:update",{tableName:"table-product-out"})}catch(p){console.error("Error deleting product out:",p),o.add({severity:"error",summary:"Gagal",detail:p?(i=(n=p.response)==null?void 0:n.data)==null?void 0:i.message:"Gagal menghapus barang keluar.",life:3e3})}};return(e,t)=>{const n=Z("router-view");return _.value==="add"||_.value==="edit"?(B(),K(n,{key:0})):(B(),R(Y,{key:1},[m(E,null,{default:X(()=>[b("div",ie,[b("div",ne,[b("div",ue,[b("div",de,[m(te,{"table-name":"table-product-out"}),m(re,{"table-name":"table-product-out"}),ae(S)("product_out").create?(B(),K($,{key:0,onClick:A,label:"Tambah Barang Keluar",severity:"primary",class:"text-xs"})):ee("",!0)])]),m(oe,{"table-name":"table-product-out"}),m(V,{"data-key":"id","fetch-function":l,columns:x,options:v.value,onToggleOption:t[0]||(t[0]=i=>a.value=i),"onUpdate:selectedData":t[1]||(t[1]=i=>c.value=i),"table-name":"table-product-out","selection-type":"single","use-options":"","use-paginator":""},null,8,["options"])])])]),_:1}),m(L,{visible:r.value.visible,"onUpdate:visible":t[2]||(t[2]=i=>r.value.visible=i),onConfirm:u,header:r.value.header,"header-icon":"check",list:r.value.list,message:r.value.message,severity:r.value.severity,"confirm-button-severity":r.value.confirmButtonSeverity},null,8,["visible","header","list","message","severity","confirm-button-severity"])],64))}}});export{Ke as default};
