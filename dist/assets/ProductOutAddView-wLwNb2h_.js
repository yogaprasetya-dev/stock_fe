import{u as K,O as R,v as n,a6 as A,G,N as b,p as H,w as j,o as _,y as t,c as U,t as z,b as v,Q as L,A as X,z as Y,F as Z,P as ee,E as te}from"./index-DCDvUKXo.js";import{_ as ae}from"./Card.vue_vue_type_script_setup_true_lang-DrCnTswZ.js";import{_ as oe}from"./Checkbox.vue_vue_type_script_setup_true_lang-B9YpqYCd.js";import{_ as le}from"./DatePicker.vue_vue_type_script_setup_true_lang-DALjuQLu.js";import{_ as B}from"./Dropdown.vue_vue_type_script_setup_true_lang-CVwp3vwr.js";import{_ as W}from"./Icon.vue_vue_type_script_setup_true_lang-Bj9qPpRn.js";import{_ as se}from"./InputNumber.vue_vue_type_script_setup_true_lang-BxeE40fF.js";import{_ as re}from"./InputText.vue_vue_type_script_setup_true_lang-BJxyKWA0.js";import{S as w}from"./stock.service-BJq6lT8Q.js";import{S as ie}from"./store.service-BvlUCZ66.js";import{c as ne}from"./data.utils-eGwCzW_2.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-W1x2WogQ.js";import"./index-DrEEKm_D.js";import"./index-ddyPgsAF.js";import"./index-CAfW60JH.js";import"./index-Cb8PJ9gJ.js";import"./index-DEeMGGCH.js";import"./index-Bf2Yba-6.js";import"./api.service-DQTyQFCJ.js";import"./index-D3QVXGA5.js";const de={class:"flex items-center gap-10"},ue={class:"w-full"},ce={class:"w-full"},ve={class:"w-full"},me={class:"grid grid-cols-2 w-full pr-10"},pe={class:"flex items-center gap-10 pt-2"},fe={class:"w-full"},he={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},ye={class:"w-full"},ge={class:"w-[30%] flex flex-col gap-2"},be={class:"text-xs text-center"},ke={class:"w-full"},xe={class:"h-full flex items-end"},_e={class:"w-[30px]"},we=["onClick"],Se={class:"flex justify-end pt-8"},Te={class:"flex flex-col gap-4 items-end"},je=K({__name:"ProductOutAddView",setup(Pe){const D=te(),d=R(),p=n(),m=n(),r=n(),s=n([]),S=n([]),T=n(),u=n([]),y=n(!1),i=A(0),P=n(0),C=n([]),f=n([]);G(()=>{m.value=new Date,h()});const E=()=>{i.value+=1,g()},F=a=>{i.value>0&&(i.value-=1,s.value.splice(a,1),u.value.splice(a,1),g())},O=()=>{p.value=void 0,r.value=void 0,s.value=[],u.value=[],y.value=!1,i.value=0,m.value=void 0,g()},V=()=>{D.back()},M=async()=>{try{const{data:a}=await ie.getStoreDropdown();T.value=a.data}catch(a){console.error("Error fetching store options:",a)}},g=()=>{p.value=ne(P.value)},q=a=>{if(s.value[a]){const e=C.value.find(o=>o.product.id===s.value[a].id);f.value[a]=(e==null?void 0:e.quantity)??0}else f.value[a]=0},h=async()=>{try{const{data:a}=await w.getStockOutIndex();P.value=a.data.nextCode,g()}catch(a){console.error("Error fetching stock in index:",a)}},$=async()=>{try{if(!r.value)return;const{data:a}=await w.getStoreStockById(r.value.id);C.value=a.data,S.value=a.data.map(e=>({id:e.product.id,name:e.product.name}))}catch(a){console.error("Error fetching store stock:",a)}},N=async()=>{var a,e,o,c;try{if(!p.value||!m.value){d.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!r.value){d.add({severity:"warn",summary:"Warning",detail:"Toko harus dipilih",life:3e3});return}if(i.value===0){d.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(s.value.filter(l=>l!==void 0&&l.id!==void 0).length!==i.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(i.value===0){d.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(u.value.filter(l=>l!==void 0&&l>0).length!==i.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}for(let l=0;l<s.value.length;l++){const x=s.value[l],J=u.value[l],I=f.value[l];if(J>I){d.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${x.name} tidak boleh lebih dari stok yang tersedia (${I})`,life:3e3});return}}const Q={transactionCode:p.value,date:(a=m.value)==null?void 0:a.toISOString(),storeId:((e=r.value)==null?void 0:e.id)??null,products:s.value.map((l,x)=>({productId:l.id,quantity:u.value[x]}))};await w.postStockOut(Q),d.add({severity:"success",summary:"Success",detail:"Barang keluar berhasil dibuat",life:3e3}),y.value?O():(V(),h())}catch(k){d.add({severity:"error",summary:"Error",detail:k?(c=(o=k.response)==null?void 0:o.data)==null?void 0:c.message:"Gagal membuat barang keluar",life:3e3})}};return b(()=>r.value,()=>{r.value&&($(),h())},{immediate:!0}),b(()=>s.value,()=>{h()},{immediate:!0}),b(()=>m.value,()=>{h()},{immediate:!0}),b(()=>r.value,()=>{r.value&&(s.value=[],u.value=[],f.value=[],i.value=0)},{immediate:!0}),(a,e)=>(_(),H(ae,null,{default:j(()=>[t("form",{class:"flex flex-col p-4 gap-3",onSubmit:ee(N,["prevent"])},[t("div",de,[t("div",ue,[v(re,{"model-value":p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),t("div",ce,[v(le,{"model-value":m.value,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),t("div",ve,[t("div",me,[v(B,{"model-value":r.value,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value=o),placeholder:"Pilih Toko",label:"Toko",options:T.value,onOpen:M},null,8,["model-value","options"])])]),t("div",pe,[t("div",fe,[t("button",{type:"button",onClick:E,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[e[4]||(e[4]=L(" Tambah Produk ")),v(W,{icon:"add"})])])]),i.value>0?(_(!0),U(Z,{key:0},X(i.value,o=>(_(),U("div",{key:o,class:"flex items-center gap-4 pt-2 w-full"},[t("div",he,[t("div",ye,[v(B,{"model-value":s.value[o-1],"onUpdate:modelValue":c=>s.value[o-1]=c,placeholder:"Pilih Produk",label:"Produk",options:S.value,onHide:c=>q(o-1),onOpen:$},null,8,["model-value","onUpdate:modelValue","options","onHide"])]),t("div",ge,[e[5]||(e[5]=t("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),t("span",be,Y(f.value[o-1]?f.value[o-1]:"-"),1)]),t("div",ke,[v(se,{"model-value":u.value[o-1],"onUpdate:modelValue":c=>u.value[o-1]=c,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),t("div",xe,[t("div",_e,[t("button",{type:"button",onClick:c=>F(o-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[v(W,{icon:"delete-bin"})],8,we)])])])]))),128)):z("",!0),e[7]||(e[7]=t("div",null,null,-1)),t("div",Se,[t("div",Te,[v(oe,{"model-value":y.value,"onUpdate:modelValue":e[3]||(e[3]=o=>y.value=o),label:"Tetap di sini?"},null,8,["model-value"]),t("div",{class:"flex gap-2"},[t("button",{type:"button",onClick:V,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),t("button",{type:"button",onClick:O,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[6]||(e[6]=t("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{je as default};
