import{u as A,N as H,v as s,a5 as L,E as X,M as U,p as Y,w as Z,o as k,y as o,c as S,t as q,b as c,x as $,A as ee,z as ae,F as te,O as oe,D as re}from"./index-C0yGrXwc.js";import{_ as le}from"./Card.vue_vue_type_script_setup_true_lang-Di5ffkTV.js";import{_ as se}from"./DatePicker.vue_vue_type_script_setup_true_lang-B_QhfVSi.js";import{_}from"./Dropdown.vue_vue_type_script_setup_true_lang-DQAvz-Qq.js";import{_ as ne}from"./InputNumber.vue_vue_type_script_setup_true_lang-MHD_rCco.js";import{_ as ie}from"./InputText.vue_vue_type_script_setup_true_lang-DZImwAWb.js";import{S as b}from"./stock.service-BwhD04wV.js";import{d as ue}from"./data.utils-eGwCzW_2.js";import{s as D}from"./index-DymJP3Eg.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-BzzT7Jae.js";import"./index-D9LLXCNd.js";import"./index-dKs-Fznz.js";import"./index-BT11fFDK.js";import"./index-D1FSZUOy.js";import"./index-Dq8y76Ai.js";import"./index-CCFOWCxn.js";import"./api.service-BWBnNUoO.js";import"./index-MGwmnnen.js";const de={class:"flex items-center gap-10"},ce={class:"w-full"},me={class:"w-full"},ve={class:"flex items-center gap-10 w-full"},fe={class:"w-full"},pe={class:"flex gap-4 py-1 !text-xs"},ge={class:"flex items-center gap-2"},he={class:"flex items-center gap-2"},be={key:0,class:"grid grid-cols-2 w-full pr-10"},ye={class:"grid grid-cols-2 pr-10 w-full"},ke={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},xe={class:"w-full"},we={class:"w-[30%] flex flex-col gap-2"},Se={class:"text-xs text-center"},_e={class:"w-full"},Oe=A({__name:"ProductMutationEditView",setup(Pe){const F=re(),n=H(),p=s(),m=s(),d=s(),g=s(),i=s([]),v=s([]),h=L(0),P=s(0),V=s([]),M=s([]),f=s([]),l=s(),y=s();X(()=>{const t=JSON.parse(sessionStorage.getItem("productMutation")||"{}");J(t==null?void 0:t.id),t!=null&&t.fromWarehouse?z():K()});const N=()=>{v.value=[],m.value=void 0},W=()=>{F.back()},j=()=>{p.value=ue(P.value)},G=async()=>{try{const{data:t}=await b.getStockMutationIndex();P.value=t.data.nextCode,j()}catch(t){console.error("Error fetching stock in index:",t)}},J=async t=>{try{if(!t){console.error("Product mutation ID is required");return}const{data:e}=await b.getStockMutationById(t);y.value=e.data,p.value=e.data.transactionCode,m.value=new Date(e.data.date),l.value=e.data.fromWarehouse?"warehouse":"store",d.value=e.data.fromStore?{id:e.data.fromStore.id,name:e.data.fromStore.name}:void 0,g.value=e.data.toStore?{id:e.data.toStore.id,name:e.data.toStore.name}:void 0,e.data.products.forEach(a=>{i.value.push({id:a.id,name:a.name}),v.value.push(a.quantity)}),h.value=e.data.products.length}catch(e){console.error("Error fetching product mutation:",e)}},z=async()=>{try{const{data:t}=await b.getWarehouseStockDropdown();M.value=t.data}catch(t){console.error("Error fetching warehouse stock:",t)}},K=async()=>{try{if(!d.value)return;const{data:t}=await b.getStoreStockById(d.value.id);V.value=t.data}catch(t){console.error("Error fetching store stock:",t)}},O=async()=>{var t,e,a,u,T,C,I,E;try{if(!p.value||!m.value){n.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!l.value){n.add({severity:"warn",summary:"Warning",detail:"Pilih sumber barang (Gudang/Toko)",life:3e3});return}if(l.value==="store"&&!d.value){n.add({severity:"warn",summary:"Warning",detail:"Pilih gudang sumber barang",life:3e3});return}if(!g.value){n.add({severity:"warn",summary:"Warning",detail:"Pilih toko tujuan barang",life:3e3});return}if(i.value.filter(r=>r!==void 0&&r.id!==void 0).length!==h.value){n.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(v.value.filter(r=>r!==void 0&&r>0).length!==h.value){n.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi"});return}for(let r=0;r<i.value.length;r++){const w=i.value[r],R=v.value[r],B=f.value[r];if(R>B){n.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${w.name} tidak boleh lebih dari stok yang tersedia (${B})`,life:3e3});return}}if(l.value==="store"&&((t=d.value)==null?void 0:t.id)===((e=g.value)==null?void 0:e.id)){n.add({severity:"warn",summary:"Warning",detail:"Sumber barang dan tujuan barang tidak boleh sama",life:3e3});return}const Q={transactionCode:p.value,date:(a=m.value)==null?void 0:a.toISOString(),fromWarehouse:l.value==="warehouse",fromStoreId:l.value==="store"?(u=d.value)==null?void 0:u.id:null,toStoreId:(T=g.value)==null?void 0:T.id,products:i.value.map((r,w)=>({id:r==null?void 0:r.id,quantity:v.value[w]}))};await b.updateStockMutation((C=y==null?void 0:y.value)==null?void 0:C.id,Q),n.add({severity:"success",summary:"Success",detail:"Barang Mutasi berhasil diubah",life:3e3}),W()}catch(x){n.add({severity:"error",summary:"Error",detail:x?(E=(I=x.response)==null?void 0:I.data)==null?void 0:E.message:"Gagal memperbarui barang mutasi",life:3e3})}};return U(()=>i.value,()=>{l.value==="warehouse"?i.value.forEach((t,e)=>{if(t){const a=M.value.find(u=>u.id===t.id);f.value[e]=(a==null?void 0:a.quantity)??0}else f.value[e]=0}):l.value==="store"&&i.value.forEach((t,e)=>{if(t){const a=V.value.find(u=>u.product.id===t.id);f.value[e]=(a==null?void 0:a.quantity)??0}else f.value[e]=0})},{immediate:!0,deep:!0}),U(()=>m.value,()=>{G()},{immediate:!0}),(t,e)=>(k(),Y(le,null,{default:Z(()=>[o("form",{class:"flex flex-col p-4 gap-3",onSubmit:oe(O,["prevent"])},[o("div",de,[o("div",ce,[c(ie,{"model-value":p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),o("div",me,[c(se,{"model-value":m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),o("div",ve,[o("div",fe,[e[8]||(e[8]=o("span",{class:"text-xs"},"Dari Gudang/Toko",-1)),o("div",pe,[o("div",ge,[c($(D),{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value=a),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small",disabled:""},null,8,["modelValue"]),e[6]||(e[6]=o("label",{for:"warehouse"},"Gudang",-1))]),o("div",he,[c($(D),{modelValue:l.value,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value=a),inputId:"store",name:"toWarehouse",value:"store",size:"small",disabled:""},null,8,["modelValue"]),e[7]||(e[7]=o("label",{for:"store"},"Toko",-1))])])])]),l.value==="store"?(k(),S("div",be,[c(_,{"model-value":d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),placeholder:"Pilih Toko",label:"Sumber Barang","disabled-button":""},null,8,["model-value"])])):q("",!0),o("div",ye,[c(_,{"model-value":g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),placeholder:"Pilih Toko",label:"Tujuan Barang","disabled-button":""},null,8,["model-value"])]),h.value>0?(k(!0),S(te,{key:1},ee(h.value,a=>(k(),S("div",{key:a,class:"flex items-center gap-4 pt-2 w-full"},[o("div",ke,[o("div",xe,[c(_,{"model-value":i.value[a-1],"onUpdate:modelValue":u=>i.value[a-1]=u,placeholder:"Pilih Produk",label:"Produk","disabled-button":""},null,8,["model-value","onUpdate:modelValue"])]),o("div",we,[e[9]||(e[9]=o("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),o("span",Se,ae(f.value[a-1]?f.value[a-1]:"-"),1)]),o("div",_e,[c(ne,{"model-value":v.value[a-1],"onUpdate:modelValue":u=>v.value[a-1]=u,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])])])]))),128)):q("",!0),e[11]||(e[11]=o("div",null,null,-1)),o("div",{class:"flex justify-end pt-8"},[o("div",{class:"flex flex-col gap-4 items-end"},[o("div",{class:"flex gap-2"},[o("button",{type:"button",onClick:W,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),o("button",{type:"button",onClick:N,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[10]||(e[10]=o("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{Oe as default};
