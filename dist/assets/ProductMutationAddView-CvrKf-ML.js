import{_ as Y}from"./api.service-Dgs1boU1.js";import{_ as Z}from"./Checkbox.vue_vue_type_script_setup_true_lang-BE2iSHdx.js";import{_ as ee}from"./DatePicker.vue_vue_type_script_setup_true_lang-DWsIWa76.js";import{_ as P}from"./Dropdown.vue_vue_type_script_setup_true_lang-6IRzW13W.js";import{_ as E}from"./Icon.vue_vue_type_script_setup_true_lang-MXjzyZbO.js";import{_ as ae}from"./InputNumber.vue_vue_type_script_setup_true_lang-DaGHc2o6.js";import{_ as te}from"./InputText.vue_vue_type_script_setup_true_lang-e6c03x4O.js";import{S as x}from"./stock.service-C4NW6Gnu.js";import{S as oe}from"./store.service-DK6LsYTS.js";import{d as le}from"./data.utils-Cp1LBIu0.js";import{u as se,M as re,v as r,a5 as ne,y as ie,L as O,p as de,w as ue,o as w,z as a,c as T,t as q,b as i,x as F,N as ce,C as ve,A as me,F as pe,E as fe}from"./index-DOh3iN_U.js";import{s as N}from"./index-BDjMOC8z.js";import"./auth.service-BxJEy6Ur.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-DO9keWeT.js";import"./index-HQkD5G-S.js";import"./index-CC8nIHWH.js";import"./index-__IG_7Gg.js";import"./index-LYmElTQ-.js";import"./index-4eifDWYF.js";import"./index-QsIXXSH_.js";const he={class:"flex flex-col p-4 gap-3"},ge={class:"flex items-center gap-10"},be={class:"w-full"},ke={class:"w-full"},ye={class:"flex items-center gap-10 w-full"},xe={class:"w-full"},we={class:"flex gap-4 py-1 !text-xs"},_e={class:"flex items-center gap-2"},Se={class:"flex items-center gap-2"},Ve={key:0,class:"grid grid-cols-2 w-full pr-10"},Pe={class:"grid grid-cols-2 pr-10 w-full"},Te={class:"flex items-center gap-10 pt-2"},Ce={class:"w-[460px]"},We={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},Me={class:"w-full"},Ue={class:"w-[30%] flex flex-col gap-2"},$e={class:"text-xs text-center"},Ie={class:"w-full"},Be={class:"h-full flex items-end"},De={class:"w-[30px]"},Ee=["onClick"],Oe={class:"flex justify-end pt-8"},qe={class:"flex flex-col gap-4 items-end"},na=se({__name:"ProductMutationAddView",setup(Fe){const j=fe(),d=re(),f=r(),u=r(),c=r(),h=r(),n=r([]),_=r([]),S=r(),p=r([]),b=r(!1),v=ne(0),C=r(0),W=r([]),M=r([]),g=r([]),s=r();ie(()=>{u.value=new Date,y()});const G=()=>{v.value+=1,k()},Q=t=>{v.value>0&&(v.value-=1,n.value.splice(t,1),p.value.splice(t,1),k())},U=()=>{f.value=void 0,u.value=void 0,c.value=void 0,h.value=void 0,n.value=[],p.value=[],b.value=!1,v.value=0,u.value=void 0,k()},$=()=>{j.back()},I=async()=>{try{const{data:t}=await oe.getStoreDropdown();S.value=t.data}catch(t){console.error("Error fetching store options:",t)}},k=()=>{f.value=le(C.value)},z=t=>{if(n.value[t]){if(s.value==="warehouse"){const e=M.value.find(o=>o.id===n.value[t].id);g.value[t]=(e==null?void 0:e.quantity)??0}else if(s.value==="store"){const e=W.value.find(o=>o.product.id===n.value[t].id);g.value[t]=(e==null?void 0:e.quantity)??0}}else g.value[t]=0},y=async()=>{try{const{data:t}=await x.getStockMutationIndex();C.value=t.data.nextCode,k()}catch(t){console.error("Error fetching stock in index:",t)}},H=async()=>{s.value=="store"?await K():s.value=="warehouse"&&await J()},J=async()=>{try{const{data:t}=await x.getWarehouseStockDropdown();M.value=t.data,_.value=t.data.map(e=>({id:e.id,name:e.name}))}catch(t){console.error("Error fetching warehouse stock:",t)}},K=async()=>{try{if(!c.value)return;const{data:t}=await x.getStoreStockById(c.value.id);W.value=t.data,_.value=t.data.map(e=>({id:e.product.id,name:e.product.name}))}catch(t){console.error("Error fetching store stock:",t)}},R=async()=>{var t,e,o,m,B;try{if(!f.value||!u.value){d.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!s.value){d.add({severity:"warn",summary:"Warning",detail:"Pilih sumber barang (Gudang/Toko)",life:3e3});return}if(s.value==="store"&&!c.value){d.add({severity:"warn",summary:"Warning",detail:"Pilih gudang sumber barang",life:3e3});return}if(!h.value){d.add({severity:"warn",summary:"Warning",detail:"Pilih toko tujuan barang",life:3e3});return}if(n.value.filter(l=>l!==void 0&&l.id!==void 0).length!==v.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(p.value.filter(l=>l!==void 0&&l>0).length!==v.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi"});return}for(let l=0;l<n.value.length;l++){const V=n.value[l],X=p.value[l],D=g.value[l];if(X>D){d.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${V.name} tidak boleh lebih dari stok yang tersedia (${D})`,life:3e3});return}}if(s.value==="store"&&((t=c.value)==null?void 0:t.id)===((e=h.value)==null?void 0:e.id)){d.add({severity:"warn",summary:"Warning",detail:"Sumber barang dan tujuan barang tidak boleh sama",life:3e3});return}const L={transactionCode:f.value,date:(o=u.value)==null?void 0:o.toISOString(),fromWarehouse:s.value==="warehouse",fromStoreId:s.value==="store"?(m=c.value)==null?void 0:m.id:null,toStoreId:(B=h.value)==null?void 0:B.id,products:n.value.map((l,V)=>({productId:l==null?void 0:l.id,quantity:p.value[V]}))};await x.postStockMutation(L),d.add({severity:"success",summary:"Success",detail:"Stok mutasi berhasil dibuat",life:3e3}),b.value?U():($(),y())}catch{d.add({severity:"error",summary:"Error",detail:"Gagal membuat stok mutasi",life:3e3})}};return O(()=>n.value,()=>{y()},{immediate:!0}),O(()=>u.value,()=>{y()},{immediate:!0}),(t,e)=>(w(),de(Y,null,{default:ue(()=>[a("div",he,[a("div",ge,[a("div",be,[i(te,{"model-value":f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),a("div",ke,[i(ee,{"model-value":u.value,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value=o),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),a("div",ye,[a("div",xe,[e[9]||(e[9]=a("span",{class:"text-xs"},"Dari Gudang/Toko",-1)),a("div",we,[a("div",_e,[i(F(N),{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=o=>s.value=o),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small"},null,8,["modelValue"]),e[7]||(e[7]=a("label",{for:"warehouse"},"Gudang",-1))]),a("div",Se,[i(F(N),{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value=o),inputId:"store",name:"toWarehouse",value:"store",size:"small"},null,8,["modelValue"]),e[8]||(e[8]=a("label",{for:"store"},"Toko",-1))])])])]),s.value==="store"?(w(),T("div",Ve,[i(P,{"model-value":c.value,"onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),placeholder:"Pilih Toko",label:"Sumber Barang",options:S.value,onOpen:I},null,8,["model-value","options"])])):q("",!0),a("div",Pe,[i(P,{"model-value":h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),placeholder:"Pilih Toko",label:"Tujuan Barang",options:S.value,onOpen:I},null,8,["model-value","options"])]),a("div",Te,[a("div",Ce,[a("button",{onClick:G,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[e[10]||(e[10]=ce(" Tambah Produk ")),i(E,{icon:"add"})])])]),v.value>0?(w(!0),T(pe,{key:1},ve(v.value,o=>(w(),T("div",{key:o,class:"flex items-center gap-4 pt-2 w-full"},[a("div",We,[a("div",Me,[i(P,{"model-value":n.value[o-1],"onUpdate:modelValue":m=>n.value[o-1]=m,placeholder:"Pilih Produk",label:"Produk",options:_.value,onHide:m=>z(o-1),onOpen:H},null,8,["model-value","onUpdate:modelValue","options","onHide"])]),a("div",Ue,[e[11]||(e[11]=a("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),a("span",$e,me(g.value[o-1]?g.value[o-1]:"-"),1)]),a("div",Ie,[i(ae,{"model-value":p.value[o-1],"onUpdate:modelValue":m=>p.value[o-1]=m,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),a("div",Be,[a("div",De,[a("button",{onClick:m=>Q(o-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[i(E,{icon:"delete-bin"})],8,Ee)])])])]))),128)):q("",!0),e[12]||(e[12]=a("div",null,null,-1)),a("div",Oe,[a("div",qe,[i(Z,{"model-value":b.value,"onUpdate:modelValue":e[6]||(e[6]=o=>b.value=o),label:"Tetap di sini?"},null,8,["model-value"]),a("div",{class:"flex gap-2"},[a("button",{onClick:$,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),a("button",{onClick:U,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),a("button",{onClick:R,class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ")])])])])]),_:1}))}});export{na as default};
