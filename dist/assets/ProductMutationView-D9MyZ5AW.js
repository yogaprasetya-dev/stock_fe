import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-D7MsiUuK.js";import{_ as I}from"./Card.vue_vue_type_script_setup_true_lang-B4NFUPcH.js";import{_ as V}from"./DataTable.vue_vue_type_script_setup_true_lang-Dl9YGte8.js";import{_ as L}from"./DialogConfirm.vue_vue_type_style_index_0_lang-QUMqYAys.js";import{f as x}from"./data.utils-eGwCzW_2.js";import{u as R,v as p,a5 as O,E as J,L as U,q as j,a6 as H,o as S,c as E,a7 as q,y as v,b as c,N as K,I as F,K as k,D as W,J as z,p as G,w as Q,F as X,r as Y,t as Z,x as ee}from"./index-0oOXTP_c.js";import{S as A}from"./stock.service-CTeRYdEQ.js";import{_ as ae,a as te}from"./ButtonSearch.vue_vue_type_script_setup_true_lang-BgioaXuC.js";import{_ as N}from"./DatePicker.vue_vue_type_script_setup_true_lang-BIBJnkWK.js";import{e as f}from"./index-CFjhT2rJ.js";import{_ as ie}from"./Badge.vue_vue_type_script_setup_true_lang-BRyGzwI_.js";import"./Icon.vue_vue_type_script_setup_true_lang-DYEQqt6g.js";import"./Animation-Sivo8ycN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-Coo5qpyU.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-l4cvvG4K.js";import"./index-DP6Ve77D.js";import"./index-CJcf8zsd.js";import"./index-DJpLRBfJ.js";import"./index-Cl7tR-Xu.js";import"./index-C12Al79G.js";import"./index-C5F5k9v8.js";import"./api.service-A0aXenpk.js";import"./index-MGwmnnen.js";import"./InputText.vue_vue_type_script_setup_true_lang-CTGSRqYz.js";const re={class:"flex items-end justify-end gap-2","data-wv-section":"filteractionbuttons",style:{"grid-area":"2/4"}},oe=R({inheritAttrs:!1,__name:"ProductMutationFilterFields",props:{tableName:{default:"product-table"}},emits:["apply"],setup(M,{emit:h}){const b=p(4),o=p([]),a=p([]),l=p([]),s=O(!1),g=p(null),m=M,y=h;J(()=>{B(),f.on("show-filter",w)}),U(()=>{f.off("show-filter",w)});const T=()=>{const n={};if(f.emit("multi-select:hide-overlay"),o.value&&o.value.length>0){const i=o.value[0]?new Date(o.value[0]):null,r=o.value[1]?new Date(o.value[1]):new Date(o.value[0]),e=[i];r&&e.push(r),n.date=JSON.stringify(e)}if(a.value&&a.value.length>0){const i=a.value[0]?new Date(a.value[0]):null,r=a.value[1]?new Date(a.value[1]):new Date(a.value[0]),e=[i];r&&e.push(r),n.updatedAt=JSON.stringify(e)}if(l.value&&l.value.length>0){const i=l.value[0]?new Date(l.value[0]):null,r=l.value[1]?new Date(l.value[1]):new Date(l.value[0]),e=[i];r&&e.push(r),n.createdAt=JSON.stringify(e)}f.emit("data-table:apply-filter",{tableName:m==null?void 0:m.tableName,filter:n}),f.emit("data-table:clear-selected-data",{tableName:m==null?void 0:m.tableName}),y==null||y("apply",n)},_=()=>{o.value=[],a.value=[],l.value=[]},w=n=>{n.tableName===m.tableName&&(s.value=n.show)},B=()=>{if(g.value){const{children:n}=g.value,i=g.value.childElementCount,r=i%b.value;let[e,t]=[1,1];for(const u in Array.from({length:i})){const d=Number(u)===i-1;n[u].setAttribute("style",`grid-area: ${e}/${d&&r?b.value:t}`),++t>b.value&&(t=1,e++)}}};return(n,i)=>j((S(),E("div",{ref_key:"container",ref:g,class:"grid gap-4 py-2 bg-[#5080e1]/10 rounded-md px-3",style:q(`grid-template-columns: repeat(${b.value}, 1fr)`)},[v("div",null,[c(N,{"model-value":o.value,"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r),label:"Tanggal Transaksi",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),v("div",null,[c(N,{"model-value":a.value,"onUpdate:modelValue":i[1]||(i[1]=r=>a.value=r),label:"Terakhir Diubah",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),v("div",null,[c(N,{"model-value":l.value,"onUpdate:modelValue":i[2]||(i[2]=r=>l.value=r),label:"Dibuat Pada",placeholder:"Pilih Tanggal",showIcon:"",fluid:"","selection-mode":"range",iconDisplay:"input"},null,8,["model-value"])]),v("div",re,[c(C,{onClick:_,label:"Bersihkan Fields","data-wv-section":"clearbutton",severity:"secondary",class:"text-xs"}),c(C,{onClick:T,label:"Terapkan Filter","data-wv-section":"applybutton",severity:"success",class:"text-xs"})])],4)),[[H,s.value]])}}),le={class:"flex flex-col gap-2 text-black"},se={class:"flex flex-col gap-2"},ne={class:"flex flex-row justify-start gap-2"},ue={class:"w-full flex justify-end gap-2"},Ge=R({__name:"ProductMutationView",setup(M){const h=W(),b=z(),o=K(),a=p(),l=p([]),s=p({visible:!1,header:"",severity:"success",confirmButtonSeverity:"success"}),g=F(()=>{var e,t,u;return[{label:"Edit",icon:"edit",visible:((e=a==null?void 0:a.value)==null?void 0:e.status)!=="completed"&&k("product_mutation").update,command:()=>{var $,P,D;const d={id:($=a.value)==null?void 0:$.id,fromWarehouse:(P=a==null?void 0:a.value)==null?void 0:P.fromWarehouse,fromStore:(D=a==null?void 0:a.value)==null?void 0:D.fromStore};sessionStorage.setItem("productMutation",JSON.stringify(d)),h.push("/manage-product/product-mutation/edit")}},{label:"Tandai Selesai",icon:"check",visible:((t=a==null?void 0:a.value)==null?void 0:t.status)!=="completed"&&k("product_mutation").update,command:()=>{l.value=[a.value],s.value={visible:!0,header:"Tandai Barang Mutasi Selesai",severity:"success",confirmButtonSeverity:"success",message:"Apakah kamu yakin ingin menandai barang mutasi ini sebagai selesai?",list:l.value.map(d=>d.transactionCode),confirmLabel:"Tandai Selesai",actionable:!0}}},{label:"Hapus",icon:"delete-bin",danger:!0,visible:((u=a==null?void 0:a.value)==null?void 0:u.status)!=="completed"&&k("product_mutation").delete,command:()=>{l.value=[a.value],s.value={visible:!0,header:"Hapus Barang Mutasi",severity:"error",confirmButtonSeverity:"danger",message:"Apakah kamu yakin ingin menghapus barang mustasi ini?",list:l.value.map(d=>d.transactionCode),confirmLabel:"Hapus",actionable:!0}}}]}),m=e=>{switch(e){case"completed":return"Selesai";default:return"Pending"}},y=e=>{switch(e){case"completed":return"success";default:return"warning"}},T=[{header:"Kode Transaksi",field:"transactionCode",sortable:!0},{header:"Tanggal Transaksi",field:"date",sortable:!0,bodyTemplate:e=>e.date?x(new Date(e.date)):"-"},{header:"Status",field:"status",sortable:!0,bodyComponent:e=>({component:ie,props:{label:m(e.status),severity:y(e.status)}})},{header:"Barang",field:"product.name",sortable:!0,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(u=>({value:`${u.name}`}))}}},{header:"Qty",field:"product.quantity",sortable:!0,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(u=>({value:`${u.quantity}`}))}}},{header:"Sumber Barang",field:"fromStore.name",sortable:!0,bodyTemplate:e=>e.fromStore?e.fromStore.name:"Gudang"},{header:"Tujuan Barang",field:"toStore.name",sortable:!0,bodyTemplate:e=>e.toStore?e.toStore.name:"Gudang"},{header:"Terakhir Diubah",field:"updatedAt",sortable:!0,bodyTemplate:e=>e.updatedAt?x(new Date(e.updatedAt)):"-"},{header:"Dibuat Pada",field:"createdAt",sortable:!0,bodyTemplate:e=>e.createdAt?x(new Date(e.createdAt)):"-"}],_=F(()=>b.path.split("/").pop()),w=()=>{h.push("/manage-product/product-mutation/add")},B=async()=>{s.value.header==="Tandai Barang Mutasi Selesai"?await i():s.value.header==="Hapus Barang Mutasi"&&await r()},n=async e=>{try{const{data:t}=await A.getStockMutation(e);return t}catch(t){console.error("Error fetching data:",t)}},i=async()=>{var e;try{if(((e=a.value)==null?void 0:e.id)===void 0){o.add({severity:"error",summary:"Gagal",detail:"Tidak ada barang mutasi yang dipilih.",life:3e3});return}await A.patchStockMutation(a.value.id),o.add({severity:"success",summary:"Berhasil",detail:"Barang mutasi berhasil diverifikasi.",life:3e3}),s.value.visible=!1,a.value=void 0,l.value=[],f.emit("data-table:update",{tableName:"table-product-mutation"})}catch(t){console.error("Error verifying mutation stock:",t),o.add({severity:"error",summary:"Gagal",detail:"Gagal memverifikasi barang mutasi.",life:3e3})}},r=async()=>{var e;try{if(((e=a.value)==null?void 0:e.id)===void 0){o.add({severity:"error",summary:"Gagal",detail:"Tidak ada barang mutation yang dipilih.",life:3e3});return}await A.deleteStockMutation(a.value.id),o.add({severity:"success",summary:"Berhasil",detail:"Barang mutasi berhasil dihapus.",life:3e3}),s.value.visible=!1,a.value=void 0,l.value=[],f.emit("data-table:update",{tableName:"table-product-mutation"})}catch(t){console.error("Error deleting product mutation:",t),o.add({severity:"error",summary:"Gagal",detail:"Gagal menghapus barang mutasi.",life:3e3})}};return(e,t)=>{const u=Y("router-view");return _.value==="add"||_.value==="edit"?(S(),G(u,{key:0})):(S(),E(X,{key:1},[c(I,null,{default:Q(()=>[v("div",le,[v("div",se,[v("div",ne,[v("div",ue,[c(ae,{"table-name":"table-product-mutation"}),c(te,{"table-name":"table-product-mutation"}),ee(k)("product_mutation").create?(S(),G(C,{key:0,onClick:w,label:"Tambah Barang Mutasi",severity:"primary",class:"text-xs"})):Z("",!0)])]),c(oe,{"table-name":"table-product-mutation"}),c(V,{"data-key":"id","fetch-function":n,columns:T,options:g.value,onToggleOption:t[0]||(t[0]=d=>a.value=d),"table-name":"table-product-mutation","selection-type":"single","use-options":"","use-paginator":""},null,8,["options"])])])]),_:1}),c(L,{visible:s.value.visible,"onUpdate:visible":t[1]||(t[1]=d=>s.value.visible=d),onConfirm:B,header:s.value.header,"header-icon":"check",list:s.value.list,message:s.value.message,severity:s.value.severity,"confirm-button-severity":s.value.confirmButtonSeverity},null,8,["visible","header","list","message","severity","confirm-button-severity"])],64))}}});export{Ge as default};
