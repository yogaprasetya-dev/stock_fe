import{_ as B}from"./Card.vue_vue_type_script_setup_true_lang-gh1TDkQp.js";import{_ as k}from"./DataTable.vue_vue_type_script_setup_true_lang-DoAMDiQ7.js";import{S as T}from"./stock.service-D0fNIIat.js";import{f as w}from"./data.utils-eGwCzW_2.js";import{_ as M}from"./DatePicker.vue_vue_type_script_setup_true_lang-CSgYmo-c.js";import{_ as $}from"./Icon.vue_vue_type_script_setup_true_lang-OILfUkaR.js";import{_ as C}from"./Button.vue_vue_type_script_setup_true_lang-Scyf_ThQ.js";import{e as L}from"./index-CFjhT2rJ.js";import{E as N,a as j}from"./jspdf.plugin.autotable-DlLAK6x0.js";import{u as V,v as l,M as R,p as A,w as q,o as E,y as a,z as J,b as c}from"./index-BLGY9PiN.js";import"./Animation-DXeOySGV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-RgwJxa2n.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-DntlQYOE.js";import"./index-CnKRl9Ka.js";import"./index-DE-p0Kb3.js";import"./index-CTIvbH2L.js";import"./api.service-CQn7ruDf.js";import"./auth.service-CbCeYD79.js";import"./index-D4UJsXwZ.js";import"./index-zk_VFbMB.js";const K={class:"flex flex-col gap-3 text-black"},P={class:"flex flex-row gap-1 w-fit"},Q={class:"text-sm text-center"},U={class:"flex flex-col gap-2 pt-2"},z={class:"flex flex-row justify-start gap-2 w-full"},I={class:"grid grid-cols-2 gap-2 w-full"},Y={class:"w-full flex justify-end gap-2"},O={class:"flex items-center gap-1"},ge=V({__name:"ReportProductMutationView",setup(F){const b=l(),n=l(),d=l([]),f=l([["No","Tanggal Transaksi","Kode Barang","Barang","Jumlah Barang","Sumber Barang","Tujuan Barang"]]),m=l([]),v=[{field:"date",header:"Tanggal Transaksi",sortable:!1,bodyTemplate:e=>e.date?w(new Date(e.date)):"-"},{field:"product.code",header:"Kode Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(o=>({value:`${o.code}`}))}}},{field:"product.name",header:"Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(o=>({value:`${o.name}`}))}}},{field:"product.quantity",header:"Jumlah Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:e=>{var t;return(t=e==null?void 0:e.products)==null?void 0:t.map(o=>({value:`${o.quantity}`}))}}},{field:"fromStore",header:"Sumber Barang",sortable:!1,bodyTemplate:e=>e.fromStore?e==null?void 0:e.fromStore:"-"},{field:"toStore",header:"Tujuan Barang",sortable:!1,bodyTemplate:e=>e.toStore?e==null?void 0:e.toStore:"-"}],h=()=>{var s,i;if(!n.value)return;const e=((s=n==null?void 0:n.value)==null?void 0:s.getMonth())+1,t=(i=n==null?void 0:n.value)==null?void 0:i.getFullYear(),o={month:e,year:t};L.emit("data-table:apply-filter",{tableName:"table-report-product-mutation",filter:o})},y=()=>{const e=new N;let t=1;const o=n.value?n.value.toLocaleDateString("id-ID",{month:"long",year:"numeric"}):"";e.text("Laporan Barang Mutasi",105,10,{align:"center"}),e.text("Agen Sembako Mbak Endang",105,20,{align:"center"}),e.text(o,105,30,{align:"center"});const s=new Map;for(const r of d.value){const g=new Date(r.date).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"});for(const u of r.products){const p=`${g}||${u.code}||${r.fromStore}||${r.toStore}`;s.has(p)||s.set(p,{date:g,code:u.code,productName:u.name,totalQty:0,fromStore:r.fromStore,toStore:r.toStore});const S=s.get(p);S.totalQty+=u.quantity}}for(const r of s.values())m.value.push([t++,r.date,r.code,r.productName,r.totalQty.toString(),r.fromStore,r.toStore]);j(e,{head:f.value,body:m.value,styles:{fontSize:9},headStyles:{fillColor:[0,123,255]},margin:{top:40}});const i=e.output("blob"),x=URL.createObjectURL(i);window.open(x)},_=async e=>{var t;try{const{data:o}=await T.getStockMutationReport(e);return d.value=((t=o==null?void 0:o.data)==null?void 0:t.data)||[],o}catch(o){console.error("Error fetching store stock:",o)}};return R(()=>n.value,()=>{m.value=[],f.value=[["No","Tanggal Transaksi","Kode Barang","Barang","Jumlah Barang","Sumber Barang","Tujuan Barang"]]}),(e,t)=>(E(),A(B,null,{default:q(()=>{var o;return[a("div",K,[a("div",P,[t[1]||(t[1]=a("span",{class:"text-lg font-semibold"},"Laporan Barang Mutasi",-1)),a("span",Q,J((o=b.value)==null?void 0:o.name),1)]),a("div",U,[a("div",z,[a("div",I,[a("div",null,[c(M,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=s=>n.value=s),view:"month",dateFormat:"MM yy",placeholder:"Pilih Bulan & Tahun Transaksi"},null,8,["modelValue"])]),a("div",null,[c(C,{onClick:h,label:"Terapkan",severity:"primary",class:"text-xs"})])]),a("div",Y,[a("button",{onClick:y,class:"text-xs rounded-sm !px-2 !py-1 bg-blue-500 text-white hover:bg-blue-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-blue-600"},[a("div",O,[c($,{icon:"printer"}),t[2]||(t[2]=a("span",null,"Cetak Laporan",-1))])])])]),c(k,{"data-key":"id","fetch-function":_,columns:v,"use-options":!1,"table-name":"table-report-product-mutation","selection-type":"single","use-paginator":""})])])]}),_:1}))}});export{ge as default};
