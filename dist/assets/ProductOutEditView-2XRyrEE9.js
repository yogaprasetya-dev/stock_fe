import{u as N,N as U,v as n,a5 as $,E as q,M,p as W,w as F,o as b,y as a,c as I,t as J,b as h,A as K,z as Q,F as R,O as j,D as z}from"./index-DluXfAYq.js";import{_ as A}from"./Card.vue_vue_type_script_setup_true_lang-C017E02U.js";import{_ as G}from"./DatePicker.vue_vue_type_script_setup_true_lang-DicUfH2r.js";import{_ as O}from"./Dropdown.vue_vue_type_script_setup_true_lang-C3RR0OM6.js";import{_ as L}from"./InputNumber.vue_vue_type_script_setup_true_lang-BCkOs_do.js";import{_ as H}from"./InputText.vue_vue_type_script_setup_true_lang-B3fqkayH.js";import{S as x}from"./stock.service-BcUr7Xs8.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-C2fF7I71.js";import"./index-BMVdyEhO.js";import"./index-C1wKYxS8.js";import"./index-CEFGEvqD.js";import"./index-DpjZpPgD.js";import"./index-_vBxaGo6.js";import"./index-Ce4jSpJo.js";import"./api.service-O4n3iPO9.js";import"./auth.service-Bnvyf6nu.js";const X={class:"flex items-center gap-10"},Y={class:"w-full"},Z={class:"w-full"},ee={class:"w-full"},te={class:"grid grid-cols-2 pr-10 w-full"},ae={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},oe={class:"w-full"},re={class:"w-[30%] flex flex-col gap-2"},se={class:"text-xs text-center"},le={class:"w-full"},Ie=N({__name:"ProductOutEditView",setup(de){const P=z(),i=U(),p=n(),m=n(),f=n(),d=n([]),u=n([]),v=$(0),w=n([]),g=n([]),k=n();q(()=>{T(),C()});const V=()=>{u.value=[],m.value=void 0},_=()=>{P.back()},T=async()=>{var r,e,t;try{const s=(r=JSON.parse(sessionStorage.getItem("productOut")||"{}"))==null?void 0:r.id;if(!s){console.error("Product Out ID not found in session storage");return}const{data:l}=await x.getStockOutById(Number(s));k.value=l.data,p.value=l.data.transactionCode,m.value=new Date(l.data.date),f.value={id:(e=l.data.fromStore)==null?void 0:e.id,name:(t=l.data)==null?void 0:t.fromStore.name},l.data.products.forEach(c=>{d.value.push({id:c.id,name:c.name}),u.value.push(c.quantity)}),v.value=l.data.products.length}catch(s){console.error("Error fetching product out:",s)}},C=async()=>{var r;try{const e=(r=JSON.parse(sessionStorage.getItem("productOut")||"{}"))==null?void 0:r.fromStoreId;if(!e){console.error("Store ID not found in session storage");return}const{data:t}=await x.getStoreStockById(e);w.value=t.data}catch(e){console.error("Error fetching store stock:",e)}},B=async()=>{var r,e,t,s,l;try{if(!p.value||!m.value){i.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!f.value){i.add({severity:"warn",summary:"Warning",detail:"Toko harus dipilih",life:3e3});return}if(d.value.filter(o=>o!==void 0&&o.id!==void 0).length!==v.value){i.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(v.value===0){i.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(u.value.filter(o=>o!==void 0&&o>0).length!==v.value){i.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}for(let o=0;o<d.value.length;o++){const y=d.value[o],E=u.value[o],S=g.value[o];if(E>S){i.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${y.name} tidak boleh lebih dari stok yang tersedia (${S})`,life:3e3});return}}const D={transactionCode:p.value,date:(r=m.value)==null?void 0:r.toISOString(),storeId:((e=f.value)==null?void 0:e.id)??null,products:d.value.map((o,y)=>({id:o.id,quantity:u.value[y]}))};await x.updateStockOut((t=k==null?void 0:k.value)==null?void 0:t.id,D),i.add({severity:"success",summary:"Success",detail:"Stok keluar berhasil diedit",life:3e3}),_()}catch(c){i.add({severity:"error",summary:"Error",detail:c?(l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message:"Gagal memperbarui stok keluar",life:3e3})}};return M(()=>d.value,()=>{g.value=d.value.map(r=>{const e=w.value.find(t=>t.product.id===r.id);return e?e.quantity:0})},{immediate:!0,deep:!0}),(r,e)=>(b(),W(A,null,{default:F(()=>[a("form",{class:"flex flex-col p-4 gap-3",onSubmit:j(B,["prevent"])},[a("div",X,[a("div",Y,[h(H,{"model-value":p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),a("div",Z,[h(G,{"model-value":m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),a("div",ee,[a("div",te,[h(O,{"model-value":f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"Pilih Toko",label:"Toko","disabled-button":""},null,8,["model-value"])])]),v.value>0?(b(!0),I(R,{key:0},K(v.value,t=>(b(),I("div",{key:t,class:"flex items-center gap-4 pt-2 w-full"},[a("div",ae,[a("div",oe,[h(O,{"model-value":d.value[t-1],"onUpdate:modelValue":s=>d.value[t-1]=s,placeholder:"Pilih Produk",label:"Produk","disabled-button":""},null,8,["model-value","onUpdate:modelValue"])]),a("div",re,[e[3]||(e[3]=a("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),a("span",se,Q(g.value[t-1]?g.value[t-1]:"-"),1)]),a("div",le,[h(L,{"model-value":u.value[t-1],"onUpdate:modelValue":s=>u.value[t-1]=s,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])])])]))),128)):J("",!0),e[5]||(e[5]=a("div",null,null,-1)),a("div",{class:"flex justify-end pt-8"},[a("div",{class:"flex flex-col gap-4 items-end"},[a("div",{class:"flex gap-2"},[a("button",{type:"button",onClick:_,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),a("button",{type:"button",onClick:V,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e[4]||(e[4]=a("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{Ie as default};
