import{_ as J}from"./api.service-Dgs1boU1.js";import{_ as K}from"./Checkbox.vue_vue_type_script_setup_true_lang-BE2iSHdx.js";import{_ as R}from"./DatePicker.vue_vue_type_script_setup_true_lang-DWsIWa76.js";import{_ as I}from"./Dropdown.vue_vue_type_script_setup_true_lang-6IRzW13W.js";import{_ as U}from"./Icon.vue_vue_type_script_setup_true_lang-MXjzyZbO.js";import{_ as A}from"./InputNumber.vue_vue_type_script_setup_true_lang-DaGHc2o6.js";import{_ as H}from"./InputText.vue_vue_type_script_setup_true_lang-e6c03x4O.js";import{S as x}from"./stock.service-C4NW6Gnu.js";import{S as L}from"./store.service-DK6LsYTS.js";import{c as j}from"./data.utils-Cp1LBIu0.js";import{u as z,M as G,v as r,a5 as X,y as Y,L as y,p as Z,w as ee,o as b,z as e,c as B,t as te,b as u,N as ae,C as oe,A as le,F as se,E as re}from"./index-DOh3iN_U.js";import"./auth.service-BxJEy6Ur.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-DO9keWeT.js";import"./index-HQkD5G-S.js";import"./index-CC8nIHWH.js";import"./index-__IG_7Gg.js";import"./index-LYmElTQ-.js";import"./index-4eifDWYF.js";import"./index-QsIXXSH_.js";const ie={class:"flex flex-col p-4 gap-3"},de={class:"flex items-center gap-10"},ne={class:"w-full"},ue={class:"w-full"},ce={class:"w-full"},ve={class:"grid grid-cols-2 w-full pr-10"},me={class:"flex items-center gap-10 pt-2"},pe={class:"w-full"},fe={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},he={class:"w-full"},ke={class:"w-[30%] flex flex-col gap-2"},_e={class:"text-xs text-center"},ge={class:"w-full"},xe={class:"h-full flex items-end"},ye={class:"w-[30px]"},be=["onClick"],we={class:"flex justify-end pt-8"},Se={class:"flex flex-col gap-4 items-end"},Ae=z({__name:"ProductOutAddView",setup(Ce){const D=re(),n=G(),m=r(),c=r(),i=r(),s=r([]),w=r([]),S=r(),v=r([]),k=r(!1),d=X(0),C=r(0),T=r([]),f=r([]);Y(()=>{c.value=new Date,h()});const E=()=>{d.value+=1,_()},F=t=>{d.value>0&&(d.value-=1,s.value.splice(t,1),v.value.splice(t,1),_())},P=()=>{m.value=void 0,i.value=void 0,s.value=[],v.value=[],k.value=!1,d.value=0,c.value=void 0,_()},V=()=>{D.back()},M=async()=>{try{const{data:t}=await L.getStoreDropdown();S.value=t.data}catch(t){console.error("Error fetching store options:",t)}},_=()=>{m.value=j(C.value)},W=t=>{if(s.value[t]){const a=T.value.find(o=>o.product.id===s.value[t].id);f.value[t]=(a==null?void 0:a.quantity)??0}else f.value[t]=0},h=async()=>{try{const{data:t}=await x.getStockOutIndex();C.value=t.data.nextCode,_()}catch(t){console.error("Error fetching stock in index:",t)}},O=async()=>{try{if(!i.value)return;const{data:t}=await x.getStoreStockById(i.value.id);T.value=t.data,w.value=t.data.map(a=>({id:a.product.id,name:a.product.name}))}catch(t){console.error("Error fetching store stock:",t)}},q=async()=>{var t,a;try{if(!m.value||!c.value){n.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!i.value){n.add({severity:"warn",summary:"Warning",detail:"Toko harus dipilih",life:3e3});return}if(s.value.filter(l=>l!==void 0&&l.id!==void 0).length!==d.value){n.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(d.value===0){n.add({severity:"warn",summary:"Warning",detail:"Tidak ada produk yang dipilih",life:3e3});return}if(v.value.filter(l=>l!==void 0&&l>0).length!==d.value){n.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}for(let l=0;l<s.value.length;l++){const g=s.value[l],Q=v.value[l],$=f.value[l];if(Q>$){n.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${g.name} tidak boleh lebih dari stok yang tersedia (${$})`,life:3e3});return}}const N={transactionCode:m.value,date:(t=c.value)==null?void 0:t.toISOString(),storeId:((a=i.value)==null?void 0:a.id)??null,products:s.value.map((l,g)=>({productId:l.id,quantity:v.value[g]}))};await x.postStockOut(N),n.add({severity:"success",summary:"Success",detail:"Stok keluar berhasil dibuat",life:3e3}),k.value?P():(V(),h())}catch{n.add({severity:"error",summary:"Error",detail:"Gagal membuat stok keluar",life:3e3})}};return y(()=>i.value,()=>{i.value&&(O(),h())},{immediate:!0}),y(()=>s.value,()=>{h()},{immediate:!0}),y(()=>c.value,()=>{h()},{immediate:!0}),(t,a)=>(b(),Z(J,null,{default:ee(()=>[e("div",ie,[e("div",de,[e("div",ne,[u(H,{"model-value":m.value,"onUpdate:modelValue":a[0]||(a[0]=o=>m.value=o),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),e("div",ue,[u(R,{"model-value":c.value,"onUpdate:modelValue":a[1]||(a[1]=o=>c.value=o),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),e("div",ce,[e("div",ve,[u(I,{"model-value":i.value,"onUpdate:modelValue":a[2]||(a[2]=o=>i.value=o),placeholder:"Pilih Toko",label:"Toko",options:S.value,onOpen:M},null,8,["model-value","options"])])]),e("div",me,[e("div",pe,[e("button",{onClick:E,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[a[4]||(a[4]=ae(" Tambah Produk ")),u(U,{icon:"add"})])])]),d.value>0?(b(!0),B(se,{key:0},oe(d.value,o=>(b(),B("div",{key:o,class:"flex items-center gap-4 pt-2 w-full"},[e("div",fe,[e("div",he,[u(I,{"model-value":s.value[o-1],"onUpdate:modelValue":p=>s.value[o-1]=p,placeholder:"Pilih Produk",label:"Produk",options:w.value,onHide:p=>W(o-1),onOpen:O},null,8,["model-value","onUpdate:modelValue","options","onHide"])]),e("div",ke,[a[5]||(a[5]=e("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),e("span",_e,le(f.value[o-1]?f.value[o-1]:"-"),1)]),e("div",ge,[u(A,{"model-value":v.value[o-1],"onUpdate:modelValue":p=>v.value[o-1]=p,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),e("div",xe,[e("div",ye,[e("button",{onClick:p=>F(o-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[u(U,{icon:"delete-bin"})],8,be)])])])]))),128)):te("",!0),a[6]||(a[6]=e("div",null,null,-1)),e("div",we,[e("div",Se,[u(K,{"model-value":k.value,"onUpdate:modelValue":a[3]||(a[3]=o=>k.value=o),label:"Tetap di sini?"},null,8,["model-value"]),e("div",{class:"flex gap-2"},[e("button",{onClick:V,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),e("button",{onClick:P,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e("button",{onClick:q,class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ")])])])])]),_:1}))}});export{Ae as default};
