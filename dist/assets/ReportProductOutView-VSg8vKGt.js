import{_ as T}from"./Card.vue_vue_type_script_setup_true_lang-CJ3s6G5O.js";import{_ as L}from"./DataTable.vue_vue_type_script_setup_true_lang-yo3Sz6x9.js";import{S as V}from"./stock.service-B2y6LNd0.js";import{f as $}from"./data.utils-eGwCzW_2.js";import{_ as I}from"./DatePicker.vue_vue_type_script_setup_true_lang-DL8FJq_E.js";import{_ as M}from"./Icon.vue_vue_type_script_setup_true_lang-DxcduwJX.js";import{_ as N}from"./Button.vue_vue_type_script_setup_true_lang-Di6FGKpm.js";import{e as C}from"./index-CFjhT2rJ.js";import{E as R,a as K}from"./jspdf.plugin.autotable-DighoPdI.js";import{s as x}from"./index-DjmGcxav.js";import{u as O,v as p,N as _,p as U,w as A,o as J,y as l,b as m,x as S}from"./index-BNjj_UGP.js";import"./Animation-BFfuRQu2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-BNAyMckb.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-sphyQ4hH.js";import"./index-CS0X4VAX.js";import"./index-CCmXKRZY.js";import"./index-D7omFGKa.js";import"./api.service-DKX_NyGr.js";import"./index-MGwmnnen.js";import"./index-CzCJ9FlB.js";import"./index-Cf-SsLG5.js";const P={class:"flex flex-col gap-3 text-black"},j={class:"flex flex-col gap-2 pt-2"},q={class:"flex flex-row justify-start gap-2 w-full items-center"},z={class:"pr-4"},E={class:"flex gap-4 py-1 !text-xs"},H={class:"flex items-center gap-2"},Q={class:"flex items-center gap-2"},Y={class:"grid grid-cols-2 gap-2 w-full"},G={class:"w-full flex justify-end gap-2"},W={class:"flex items-center gap-1"},xe=O({__name:"ReportProductOutView",setup(X){const n=p("date"),t=p(),v=p([]),h=p([["No","Tanggal Transaksi","Kode Barang","Barang","Jumlah Barang","Sumber Barang"]]),c=p([]),w=[{field:"date",header:"Tanggal Transaksi",sortable:!1,bodyTemplate:a=>a.date?$(new Date(a.date)):"-"},{field:"product.code",header:"Kode Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:a=>{var e;return(e=a==null?void 0:a.products)==null?void 0:e.map(o=>({value:`${o.code}`}))}}},{field:"product.name",header:"Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:a=>{var e;return(e=a==null?void 0:a.products)==null?void 0:e.map(o=>({value:`${o.name}`}))}}},{field:"product.quantity",header:"Jumlah Barang",sortable:!1,preset:{type:"multirow",fieldAttributes:a=>{var e;return(e=a==null?void 0:a.products)==null?void 0:e.map(o=>({value:`${o.quantity}`}))}}},{field:"fromStore",header:"Sumber Barang",sortable:!1,bodyTemplate:a=>a.fromStore?a==null?void 0:a.fromStore:"-"}],D=()=>{var e;const a={};if(t.value&&((e=t==null?void 0:t.value)==null?void 0:e.length)>0){if(n.value==="month"){let u=new Date(t.value[0]);u.setDate(u.getDate()+1),u.setHours(0,0,0,0);let i=new Date(t.value[1]);i.setDate(i.getDate()+1),i.setHours(0,0,0,0)}let o=t.value[0],r=t.value[1]?new Date(t.value[1]):new Date(t.value[0]);n.value==="month"&&(o==null||o.setDate(1),r==null||r.setMonth(r.getMonth()+1),r==null||r.setDate(0),r==null||r.setHours(23,59,59,999));const f=[o];r&&f.push(r),a.date=JSON.stringify(f),C.emit("data-table:apply-filter",{tableName:"table-report-product-out",filter:a})}},B=()=>{var u,i,b,y;const a=new R;let e="";if(t.value&&t.value.length>0){const s=t.value[0],d=t.value[1]||new Date(t.value[0]);n.value==="month"?e=((u=t==null?void 0:t.value)==null?void 0:u.length)>1&&!((i=t==null?void 0:t.value)!=null&&i.includes(null))?`${s.toLocaleDateString("id-ID",{month:"long",year:"numeric"})} - ${d.toLocaleDateString("id-ID",{month:"long",year:"numeric"})}`:s.toLocaleDateString("id-ID",{month:"long",year:"numeric"}):e=((b=t==null?void 0:t.value)==null?void 0:b.length)>1&&!((y=t==null?void 0:t.value)!=null&&y.includes(null))?`${s.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})} - ${d.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})}`:s.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})}a.text("Laporan Barang Keluar",105,10,{align:"center"}),a.text("Agen Sembako Mbak Endang",105,20,{align:"center"}),a.text(e,105,30,{align:"center"});let o=[];for(const s of v.value){const d=new Date(s.date).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"});for(const g of s.products)o.push({date:d,code:g.code,productName:g.name,totalQty:g.quantity,fromStore:s.fromStore})}o.map((s,d)=>{c.value.push([d+1,s.date,s.code,s.productName,s.totalQty.toString(),s.fromStore])}),K(a,{head:h.value,body:c.value,styles:{fontSize:9},headStyles:{fillColor:[0,123,255]},margin:{top:40}});const r=a.output("blob"),f=URL.createObjectURL(r);window.open(f),c.value=[]},k=async a=>{var e;try{const{data:o}=await V.getStockOutReport(a);return v.value=((e=o==null?void 0:o.data)==null?void 0:e.data)||[],o}catch(o){console.error("Error fetching store stock:",o)}};return _(()=>t.value,()=>{c.value=[],h.value=[["No","Tanggal Transaksi","Kode Barang","Barang","Jumlah Barang","Sumber Barang"]]}),_(()=>n.value,()=>{n.value&&(t.value=void 0)},{immediate:!0}),(a,e)=>(J(),U(T,null,{default:A(()=>[l("div",P,[e[7]||(e[7]=l("div",{class:"flex flex-row gap-1 w-fit"},[l("span",{class:"text-lg font-semibold"},"Laporan Barang Keluar")],-1)),l("div",j,[l("div",q,[l("div",z,[e[5]||(e[5]=l("span",{class:"text-xs"},"Filter Berdasarkan",-1)),l("div",E,[l("div",H,[m(S(x),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),inputId:"date",name:"date",value:"date",size:"small"},null,8,["modelValue"]),e[3]||(e[3]=l("label",{for:"warehouse"},"Tanggal",-1))]),l("div",Q,[m(S(x),{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),inputId:"month",name:"month",value:"month",size:"small"},null,8,["modelValue"]),e[4]||(e[4]=l("label",{for:"store"},"Bulan",-1))])])]),l("div",Y,[l("div",null,[m(I,{modelValue:t.value,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value=o),view:n.value==="date"?"date":"month",dateFormat:n.value==="date"?"dd MM yy":"MM yy",placeholder:n.value==="date"?"Pilih Tanggal Transaksi":"Pilih Bulan & Tahun Transaksi","selection-mode":"range"},null,8,["modelValue","view","dateFormat","placeholder"])]),l("div",null,[m(N,{onClick:D,label:"Terapkan",severity:"primary",class:"text-xs"})])]),l("div",G,[l("button",{onClick:B,class:"text-xs rounded-sm !px-2 !py-1 bg-blue-500 text-white hover:bg-blue-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-blue-600"},[l("div",W,[m(M,{icon:"printer"}),e[6]||(e[6]=l("span",null,"Cetak Laporan",-1))])])])]),m(L,{"data-key":"id","fetch-function":k,columns:w,"use-options":!1,"table-name":"table-report-product-out","selection-type":"single","use-paginator":""})])])]),_:1}))}});export{xe as default};
