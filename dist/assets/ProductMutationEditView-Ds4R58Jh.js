import{u as O,O as Q,v as d,a6 as R,G as A,N as H,p as L,w as X,o as w,y as o,c as P,t as E,b as m,x as B,A as Y,z as Z,F as ee,P as ae,E as te}from"./index-hWW29s6s.js";import{_ as oe}from"./Card.vue_vue_type_script_setup_true_lang-Crk-f3gY.js";import{_ as re}from"./DatePicker.vue_vue_type_script_setup_true_lang-HpdiHGB9.js";import{_ as V}from"./Dropdown.vue_vue_type_script_setup_true_lang-hL_AeIO6.js";import{_ as le}from"./InputNumber.vue_vue_type_script_setup_true_lang-DjE6xGP8.js";import{_ as se}from"./InputText.vue_vue_type_script_setup_true_lang-B0hOXlSt.js";import{S as k}from"./stock.service-DU24jw1z.js";import{d as ne}from"./data.utils-eGwCzW_2.js";import{s as U}from"./index-wcSDmgdM.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-Bj-gQ17_.js";import"./index-BiJc2Fi6.js";import"./index-DKMYSfv0.js";import"./index-DfSJzKmE.js";import"./index-BgKJ5Lam.js";import"./index-QJmaLRHl.js";import"./index-CFJ9N7VM.js";import"./api.service-D-b--VpV.js";import"./index-MGwmnnen.js";const ie={class:"flex items-center gap-10"},de={class:"w-full"},ue={class:"w-full"},ce={class:"flex items-center gap-10 w-full"},me={class:"w-full"},ve={class:"flex gap-4 py-1 !text-xs"},fe={class:"flex items-center gap-2"},pe={class:"flex items-center gap-2"},ge={key:0,class:"grid grid-cols-2 w-full pr-10"},he={class:"grid grid-cols-2 pr-10 w-full"},be={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},ye={class:"w-full"},ke={class:"w-[30%] flex flex-col gap-2"},xe={class:"text-xs text-center"},we={class:"w-full"},ze=O({__name:"ProductMutationEditView",setup(Se){const q=te(),i=Q(),g=d(),v=d(),h=d(),b=d(),u=d([]),f=d([]),y=R(0),M=d(0),p=d([]),n=d(),x=d();A(()=>{const r=JSON.parse(sessionStorage.getItem("productMutation")||"{}");N(r==null?void 0:r.id)});const $=()=>{f.value=[],v.value=void 0},W=()=>{q.back()},D=()=>{g.value=ne(M.value)},G=async()=>{try{const{data:r}=await k.getStockMutationIndex();M.value=r.data.nextCode,D()}catch(r){console.error("Error fetching stock in index:",r)}},N=async r=>{var e,a,l;try{if(!r){console.error("Product mutation ID is required");return}const{data:t}=await k.getStockMutationById(r);x.value=t.data,g.value=t.data.transactionCode,v.value=new Date(t.data.date),n.value=t.data.fromWarehouse?"warehouse":"store",h.value=t.data.fromStore?{id:t.data.fromStore.id_store,name:t.data.fromStore.name}:void 0,b.value=t.data.toStore?{id:t.data.toStore.id,name:t.data.toStore.name}:void 0,t.data.products.forEach(c=>{u.value.push({id:c.id,name:c.name}),f.value.push(c.quantity)}),y.value=t.data.products.length,(e=t==null?void 0:t.data)!=null&&e.fromWarehouse?j():F((l=(a=t==null?void 0:t.data)==null?void 0:a.fromStore)==null?void 0:l.id_store)}catch(t){console.error("Error fetching product mutation:",t)}},j=async()=>{try{const{data:r}=await k.getWarehouseStockDropdown();u.value.forEach((e,a)=>{if(e){const l=r.data.find(t=>t.id===e.id);p.value[a]=(l==null?void 0:l.quantity)??0}else p.value[a]=0})}catch(r){console.error("Error fetching warehouse stock:",r)}},F=async r=>{try{const{data:e}=await k.getStoreStockById(r);n.value==="store"&&u.value.forEach((a,l)=>{if(a){const t=e.data.find(c=>c.product.id===a.id);p.value[l]=(t==null?void 0:t.quantity)??0}else p.value[l]=0})}catch(e){console.error("Error fetching store stock:",e)}},J=async()=>{var r,e,a,l,t,c,T,I;try{if(!g.value||!v.value){i.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(!n.value){i.add({severity:"warn",summary:"Warning",detail:"Pilih sumber barang (Gudang/Toko)",life:3e3});return}if(n.value==="store"&&!h.value){i.add({severity:"warn",summary:"Warning",detail:"Pilih gudang sumber barang",life:3e3});return}if(!b.value){i.add({severity:"warn",summary:"Warning",detail:"Pilih toko tujuan barang",life:3e3});return}if(u.value.filter(s=>s!==void 0&&s.id!==void 0).length!==y.value){i.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(f.value.filter(s=>s!==void 0&&s>0).length!==y.value){i.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi"});return}for(let s=0;s<u.value.length;s++){const _=u.value[s],K=f.value[s],C=p.value[s];if(K>C){i.add({severity:"warn",summary:"Warning",detail:`Jumlah produk ${_.name} tidak boleh lebih dari stok yang tersedia (${C})`,life:3e3});return}}if(n.value==="store"&&((r=h.value)==null?void 0:r.id)===((e=b.value)==null?void 0:e.id)){i.add({severity:"warn",summary:"Warning",detail:"Sumber barang dan tujuan barang tidak boleh sama",life:3e3});return}const z={transactionCode:g.value,date:(a=v.value)==null?void 0:a.toISOString(),fromWarehouse:n.value==="warehouse",fromStoreId:n.value==="store"?(l=h.value)==null?void 0:l.id:null,toStoreId:(t=b.value)==null?void 0:t.id,products:u.value.map((s,_)=>({id:s==null?void 0:s.id,quantity:f.value[_]}))};await k.updateStockMutation((c=x==null?void 0:x.value)==null?void 0:c.id,z),i.add({severity:"success",summary:"Success",detail:"Barang Mutasi berhasil diubah",life:3e3}),W()}catch(S){i.add({severity:"error",summary:"Error",detail:S?(I=(T=S.response)==null?void 0:T.data)==null?void 0:I.message:"Gagal memperbarui barang mutasi",life:3e3})}};return H(()=>v.value,()=>{G()},{immediate:!0}),(r,e)=>(w(),L(oe,null,{default:X(()=>[o("form",{class:"flex flex-col p-4 gap-3",onSubmit:ae(J,["prevent"])},[o("div",ie,[o("div",de,[m(se,{"model-value":g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),o("div",ue,[m(re,{"model-value":v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),o("div",ce,[o("div",me,[e[8]||(e[8]=o("span",{class:"text-xs"},"Dari Gudang/Toko",-1)),o("div",ve,[o("div",fe,[m(B(U),{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value=a),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small",disabled:""},null,8,["modelValue"]),e[6]||(e[6]=o("label",{for:"warehouse"},"Gudang",-1))]),o("div",pe,[m(B(U),{modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value=a),inputId:"store",name:"toWarehouse",value:"store",size:"small",disabled:""},null,8,["modelValue"]),e[7]||(e[7]=o("label",{for:"store"},"Toko",-1))])])])]),n.value==="store"?(w(),P("div",ge,[m(V,{"model-value":h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),placeholder:"Pilih Toko",label:"Sumber Barang","disabled-button":""},null,8,["model-value"])])):E("",!0),o("div",he,[m(V,{"model-value":b.value,"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a),placeholder:"Pilih Toko",label:"Tujuan Barang","disabled-button":""},null,8,["model-value"])]),y.value>0?(w(!0),P(ee,{key:1},Y(y.value,a=>(w(),P("div",{key:a,class:"flex items-center gap-4 pt-2 w-full"},[o("div",be,[o("div",ye,[m(V,{"model-value":u.value[a-1],"onUpdate:modelValue":l=>u.value[a-1]=l,placeholder:"Pilih Produk",label:"Produk","disabled-button":""},null,8,["model-value","onUpdate:modelValue"])]),o("div",ke,[e[9]||(e[9]=o("span",{class:"text-xs text-center"}," Stok Tersedia: ",-1)),o("span",xe,Z(p.value[a-1]?p.value[a-1]:"-"),1)]),o("div",we,[m(le,{"model-value":f.value[a-1],"onUpdate:modelValue":l=>f.value[a-1]=l,placeholder:"Jumlah",label:"Jumlah Produk",max:1e3},null,8,["model-value","onUpdate:modelValue"])])])]))),128)):E("",!0),e[11]||(e[11]=o("div",null,null,-1)),o("div",{class:"flex justify-end pt-8"},[o("div",{class:"flex flex-col gap-4 items-end"},[o("div",{class:"flex gap-2"},[o("button",{type:"button",onClick:W,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),o("button",{type:"button",onClick:$,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Input "),e[10]||(e[10]=o("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{ze as default};
