import{u as Q,N as R,v as l,a5 as q,E as z,M as b,p as A,w as J,o as k,y as e,c as _,t as U,b as r,x as M,P as j,A as L,F as H,O as X,D as Y}from"./index-0oOXTP_c.js";import{_ as Z}from"./Card.vue_vue_type_script_setup_true_lang-B4NFUPcH.js";import{_ as ee}from"./Checkbox.vue_vue_type_script_setup_true_lang-Coo5qpyU.js";import{_ as te}from"./DatePicker.vue_vue_type_script_setup_true_lang-BIBJnkWK.js";import{_ as W}from"./Dropdown.vue_vue_type_script_setup_true_lang-3t7dlsRu.js";import{_ as O}from"./Icon.vue_vue_type_script_setup_true_lang-DYEQqt6g.js";import{_ as ae}from"./InputNumber.vue_vue_type_script_setup_true_lang-DUM1THOe.js";import{_ as oe}from"./InputText.vue_vue_type_script_setup_true_lang-CTGSRqYz.js";import{P as se}from"./product.service-CUKYIa68.js";import{S as $}from"./stock.service-CTeRYdEQ.js";import{S as le}from"./store.service-BfqbFGA5.js";import{b as re}from"./data.utils-eGwCzW_2.js";import{s as D}from"./index-lES8r-rt.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-l4cvvG4K.js";import"./index-DP6Ve77D.js";import"./index-CJcf8zsd.js";import"./index-DJpLRBfJ.js";import"./index-Cl7tR-Xu.js";import"./index-C12Al79G.js";import"./index-BbSF2dW4.js";import"./api.service-A0aXenpk.js";import"./index-MGwmnnen.js";const ne={class:"flex items-center gap-10"},ie={class:"w-full"},de={class:"w-full"},ue={class:"flex items-center gap-10"},ce={class:"w-full"},me={class:"flex gap-4 py-1 !text-xs"},ve={class:"flex items-center gap-2"},pe={class:"flex items-center gap-2"},fe={key:0,class:"w-full"},he={class:"flex items-center gap-10 pt-2"},be={class:"w-full"},ge={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},xe={class:"w-full"},ke={class:"w-full"},ye={class:"h-full flex items-end"},_e={class:"w-[30px]"},we=["onClick"],Pe={class:"flex justify-end pt-8"},Ve={class:"flex flex-col gap-4 items-end"},He=Q({__name:"ProductInAddView",setup(Se){const B=Y(),d=R(),h=l(),u=l(),n=l(),c=l(),m=l([]),w=l(),P=l(),v=l([]),g=l(!1),s=q(0),V=l(0);z(()=>{C(),T(),u.value=new Date,i()});const E=()=>{s.value+=1,x()},F=o=>{s.value>0&&(s.value-=1,m.value.splice(o,1),v.value.splice(o,1),x())},S=()=>{h.value=void 0,n.value=void 0,c.value=void 0,m.value=[],v.value=[],g.value=!1,s.value=0,u.value=void 0,x()},I=()=>{B.back()},C=async()=>{try{const{data:o}=await le.getStoreDropdown();P.value=o.data}catch(o){console.error("Error fetching store options:",o)}},T=async()=>{try{const{data:o}=await se.getProductDropdown();w.value=o.data}catch(o){console.error("Error fetching product options:",o)}},x=()=>{h.value=re(V.value)},i=async()=>{try{const{data:o}=await $.getStockInIndex();V.value=o.data.nextCode,x()}catch(o){console.error("Error fetching stock in index:",o)}},N=async()=>{var o,t,a,p;try{if(!h.value||!u.value){d.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(n.value!=="warehouse"&&!c.value){d.add({severity:"warn",summary:"Warning",detail:"Jika tidak masuk ke gudang, pilih toko terlebih dahulu",life:3e3});return}if(s.value<=0){d.add({severity:"warn",summary:"Warning",detail:"Pastikan ada produk yang ditambahkan",life:3e3});return}if(m.value.filter(f=>f!==void 0&&f.id!==void 0).length!==s.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(v.value.filter(f=>f!==void 0&&f>0).length!==s.value){d.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi",life:3e3});return}const G={transactionCode:h.value,date:(o=u.value)==null?void 0:o.toISOString(),toWarehouse:n.value==="warehouse",storeId:((t=c.value)==null?void 0:t.id)??null,products:m.value.map((f,K)=>({productId:f.id,quantity:v.value[K]}))};await $.postStockIn(G),d.add({severity:"success",summary:"Success",detail:"Barang masuk berhasil dibuat",life:3e3}),g.value?S():(I(),i())}catch(y){d.add({severity:"error",summary:"Error",detail:y?(p=(a=y.response)==null?void 0:a.data)==null?void 0:p.message:"Gagal membuat barang masuk",life:3e3})}};return b(()=>n.value,()=>{c.value=void 0,i()},{immediate:!0}),b(()=>u.value,()=>{i()},{immediate:!0}),b(()=>s.value,()=>{i()},{immediate:!0}),b(()=>m.value,()=>{i()},{immediate:!0}),b(()=>c.value,()=>{i()},{immediate:!0}),b(()=>v.value,()=>{i()},{immediate:!0}),(o,t)=>(k(),A(Z,null,{default:J(()=>[e("form",{class:"flex flex-col p-4 gap-3",onSubmit:X(N,["prevent"])},[e("div",ne,[e("div",ie,[r(oe,{"model-value":h.value,"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),e("div",de,[r(te,{"model-value":u.value,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value=a),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),e("div",ue,[e("div",ce,[t[8]||(t[8]=e("span",{class:"text-xs"},"Masuk ke Gudang / Toko",-1)),e("div",me,[e("div",ve,[r(M(D),{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value=a),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small"},null,8,["modelValue"]),t[6]||(t[6]=e("label",{for:"warehouse"},"Gudang",-1))]),e("div",pe,[r(M(D),{modelValue:n.value,"onUpdate:modelValue":t[3]||(t[3]=a=>n.value=a),inputId:"store",name:"toWarehouse",value:"store",size:"small"},null,8,["modelValue"]),t[7]||(t[7]=e("label",{for:"store"},"Toko",-1))])])]),n.value==="store"?(k(),_("div",fe,[r(W,{"model-value":c.value,"onUpdate:modelValue":t[4]||(t[4]=a=>c.value=a),placeholder:"Pilih Toko",label:"Toko",options:P.value,onOpen:C},null,8,["model-value","options"])])):U("",!0)]),e("div",he,[e("div",be,[e("button",{type:"button",onClick:E,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[t[9]||(t[9]=j(" Tambah Produk ")),r(O,{icon:"add"})])])]),s.value>0?(k(!0),_(H,{key:0},L(s.value,a=>(k(),_("div",{key:a,class:"flex items-center gap-4 pt-2 w-full"},[e("div",ge,[e("div",xe,[r(W,{"model-value":m.value[a-1],"onUpdate:modelValue":p=>m.value[a-1]=p,placeholder:"Pilih Produk",label:"Produk",options:w.value,onOpen:T},null,8,["model-value","onUpdate:modelValue","options"])]),e("div",ke,[r(ae,{"model-value":v.value[a-1],"onUpdate:modelValue":p=>v.value[a-1]=p,placeholder:"Jumlah",label:"Quantity",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),e("div",ye,[e("div",_e,[e("button",{type:"button",onClick:p=>F(a-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[r(O,{icon:"delete-bin"})],8,we)])])])]))),128)):U("",!0),e("div",Pe,[e("div",Ve,[r(ee,{"model-value":g.value,"onUpdate:modelValue":t[5]||(t[5]=a=>g.value=a),label:"Tetap di sini?"},null,8,["model-value"]),e("div",{class:"flex gap-2"},[e("button",{type:"button",onClick:I,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),e("button",{type:"button",onClick:S,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),t[10]||(t[10]=e("button",{type:"submit",class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ",-1))])])])],32)]),_:1}))}});export{He as default};
