import{_ as G}from"./api.service-Dgs1boU1.js";import{_ as K}from"./Checkbox.vue_vue_type_script_setup_true_lang-BE2iSHdx.js";import{_ as Q}from"./DatePicker.vue_vue_type_script_setup_true_lang-DWsIWa76.js";import{_ as T}from"./Dropdown.vue_vue_type_script_setup_true_lang-6IRzW13W.js";import{_ as U}from"./Icon.vue_vue_type_script_setup_true_lang-MXjzyZbO.js";import{_ as R}from"./InputNumber.vue_vue_type_script_setup_true_lang-DaGHc2o6.js";import{_ as q}from"./InputText.vue_vue_type_script_setup_true_lang-e6c03x4O.js";import{P as J}from"./product.service-8g3w9OI2.js";import{S as M}from"./stock.service-C4NW6Gnu.js";import{S as L}from"./store.service-DK6LsYTS.js";import{b as j}from"./data.utils-Cp1LBIu0.js";import{u as A,M as H,v as s,a5 as X,y as Y,L as h,p as Z,w as ee,o as _,z as e,c as b,t as W,b as l,x as $,N as te,C as oe,F as ae,E as se}from"./index-DOh3iN_U.js";import{s as O}from"./index-BDjMOC8z.js";import"./auth.service-BxJEy6Ur.js";import"./InputGroup.vue_vue_type_script_setup_true_lang-DO9keWeT.js";import"./index-HQkD5G-S.js";import"./index-CC8nIHWH.js";import"./index-__IG_7Gg.js";import"./index-LYmElTQ-.js";import"./index-4eifDWYF.js";import"./index-QsIXXSH_.js";const le={class:"flex flex-col p-4 gap-3"},re={class:"flex items-center gap-10"},de={class:"w-full"},ie={class:"w-full"},ne={class:"flex items-center gap-10"},ue={class:"w-full"},ce={class:"flex gap-4 py-1 !text-xs"},me={class:"flex items-center gap-2"},ve={class:"flex items-center gap-2"},pe={key:0,class:"w-full"},fe={class:"flex items-center gap-10 pt-2"},he={class:"w-full"},xe={class:"flex items-center gap-10 pt-2 h-[60px] w-full"},ke={class:"w-full"},ge={class:"w-full"},_e={class:"h-full flex items-end"},be={class:"w-[30px]"},we=["onClick"],ye={class:"flex justify-end pt-8"},Ve={class:"flex flex-col gap-4 items-end"},Le=A({__name:"ProductInAddView",setup(Pe){const D=se(),p=H(),f=s(),n=s(),r=s(),u=s(),c=s([]),w=s(),y=s(),m=s([]),k=s(!1),d=X(0),V=s(0);Y(()=>{C(),I(),n.value=new Date,i()});const E=()=>{d.value+=1,g()},F=a=>{d.value>0&&(d.value-=1,c.value.splice(a,1),m.value.splice(a,1),g())},P=()=>{f.value=void 0,r.value=void 0,u.value=void 0,c.value=[],m.value=[],k.value=!1,d.value=0,n.value=void 0,g()},S=()=>{D.back()},C=async()=>{try{const{data:a}=await L.getStoreDropdown();y.value=a.data}catch(a){console.error("Error fetching store options:",a)}},I=async()=>{try{const{data:a}=await J.getProductDropdown();w.value=a.data}catch(a){console.error("Error fetching product options:",a)}},g=()=>{f.value=j(V.value)},i=async()=>{try{const{data:a}=await M.getStockInIndex();V.value=a.data.nextCode,g()}catch(a){console.error("Error fetching stock in index:",a)}},B=async()=>{var a,t;try{if(!f.value||!n.value){p.add({severity:"warn",summary:"Warning",detail:"Transaction code and date are required",life:3e3});return}if(r.value!=="warehouse"&&!u.value){p.add({severity:"warn",summary:"Warning",detail:"Jika tidak masuk ke gudang, pilih toko terlebih dahulu",life:3e3});return}if(c.value.filter(v=>v!==void 0&&v.id!==void 0).length!==d.value){p.add({severity:"warn",summary:"Warning",detail:"Pastikan semua produk telah dipilih",life:3e3});return}if(m.value.filter(v=>v!==void 0&&v>0).length!==d.value){p.add({severity:"warn",summary:"Warning",detail:"Pastikan semua kuantitas telah diisi"});return}const N={transactionCode:f.value,date:(a=n.value)==null?void 0:a.toISOString(),toWarehouse:r.value==="warehouse",storeId:((t=u.value)==null?void 0:t.id)??null,products:c.value.map((v,z)=>({productId:v.id,quantity:m.value[z]}))};await M.postStockIn(N),p.add({severity:"success",summary:"Success",detail:"Stok masuk berhasil dibuat",life:3e3}),k.value?P():(S(),i())}catch{p.add({severity:"error",summary:"Error",detail:"Gagal membuat stok masuk",life:3e3})}};return h(()=>r.value,()=>{u.value=void 0,i()},{immediate:!0}),h(()=>n.value,()=>{i()},{immediate:!0}),h(()=>d.value,()=>{i()},{immediate:!0}),h(()=>c.value,()=>{i()},{immediate:!0}),h(()=>u.value,()=>{i()},{immediate:!0}),h(()=>m.value,()=>{i()},{immediate:!0}),(a,t)=>(_(),Z(G,null,{default:ee(()=>[e("div",le,[e("div",re,[e("div",de,[l(q,{"model-value":f.value,"onUpdate:modelValue":t[0]||(t[0]=o=>f.value=o),label:"Kode Transaksi",placeholder:"Kode transaksi",disabled:""},null,8,["model-value"])]),e("div",ie,[l(Q,{"model-value":n.value,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value=o),label:"Tanggal Transaksi",showIcon:"",fluid:"",iconDisplay:"input"},null,8,["model-value"])])]),e("div",ne,[e("div",ue,[t[8]||(t[8]=e("span",{class:"text-xs"},"Masuk ke Gudang / Toko",-1)),e("div",ce,[e("div",me,[l($(O),{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),inputId:"warehouse",name:"toWarehouse",value:"warehouse",size:"small"},null,8,["modelValue"]),t[6]||(t[6]=e("label",{for:"warehouse"},"Gudang",-1))]),e("div",ve,[l($(O),{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=o=>r.value=o),inputId:"store",name:"toWarehouse",value:"store",size:"small"},null,8,["modelValue"]),t[7]||(t[7]=e("label",{for:"store"},"Toko",-1))])])]),r.value==="store"?(_(),b("div",pe,[l(T,{"model-value":u.value,"onUpdate:modelValue":t[4]||(t[4]=o=>u.value=o),placeholder:"Pilih Toko",label:"Toko",options:y.value,onOpen:C},null,8,["model-value","options"])])):W("",!0)]),e("div",fe,[e("div",he,[e("button",{onClick:E,class:"text-xs rounded-sm px-2 py-1 bg-blue-400 text-white hover:bg-blue-500/60 hover:cursor-pointer shadow-md border-1 border-primary"},[t[9]||(t[9]=te(" Tambah Produk ")),l(U,{icon:"add"})])])]),d.value>0?(_(!0),b(ae,{key:0},oe(d.value,o=>(_(),b("div",{key:o,class:"flex items-center gap-4 pt-2 w-full"},[e("div",xe,[e("div",ke,[l(T,{"model-value":c.value[o-1],"onUpdate:modelValue":x=>c.value[o-1]=x,placeholder:"Pilih Produk",label:"Produk",options:w.value,onOpen:I},null,8,["model-value","onUpdate:modelValue","options"])]),e("div",ge,[l(R,{"model-value":m.value[o-1],"onUpdate:modelValue":x=>m.value[o-1]=x,placeholder:"Jumlah",label:"Quantity",max:1e3},null,8,["model-value","onUpdate:modelValue"])]),e("div",_e,[e("div",be,[e("button",{onClick:x=>F(o-1),class:"text-xs rounded-full px-2 py-1 bg-red-400 text-white hover:bg-red-500/60 hover:cursor-pointer shadow-md"},[l(U,{icon:"delete-bin"})],8,we)])])])]))),128)):W("",!0),e("div",ye,[e("div",Ve,[l(K,{"model-value":k.value,"onUpdate:modelValue":t[5]||(t[5]=o=>k.value=o),label:"Tetap di sini?"},null,8,["model-value"]),e("div",{class:"flex gap-2"},[e("button",{onClick:S,class:"text-xs rounded-sm !px-2 !py-1 bg-black text-white hover:bg-black/60 hover:cursor-pointer shadow-md border-1 border-gray-600"}," Kembali "),e("button",{onClick:P,class:"text-xs rounded-sm !px-2 !py-1 bg-transparent text-red-500 hover:bg-red-500/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-red-500"}," Bersihkan Field "),e("button",{onClick:B,class:"text-xs rounded-sm !px-2 !py-1 bg-green-400 text-white hover:bg-green-400/60 hover:text-white hover:cursor-pointer shadow-md border-1 border-green-500"}," Submit ")])])])])]),_:1}))}});export{Le as default};
